define(["translations","pgadmin.browser.endpoints","pgadmin.browser.utils","pgadmin.browser.messages"],function(e,t,n,r){return webpackJsonp([1,3],{153:function(e,t,n){"use strict";var r,i;r=[n(0),n(1),n(4)],void 0!==(i=function(e,t,n){return function(e,r){if(t.isUndefined(r)||t.isNull(r))return!0;n.startsWith(r,"coll-")&&(r=r.replace("coll-",""));var i=["server_group","server","catalog_object_column"];if(t.indexOf(i,r)>=0)return!0;var o=e.get_preference("browser","show_node_"+r);return!o||o.value}}.apply(t,r))&&(e.exports=i)},158:function(e,t,n){"use strict";var r,i;r=[n(0)],void 0!==(i=function(e){return{epicRandomString:function(e){for(var t=[],n="0123456789abcdef",r=0;r<36;r++)t[r]=n.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=n.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("").replace(/-/g,"").substr(0,e)},getHash:function(e){for(var t=0,n=e.length,r=0;r<n;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t},calculateColumnWidth:function(t){e("body").append('<span id="pg_text" style="visibility: hidden;">'+t+"</span>");var n=e("#pg_text").width()+23;return e("#pg_text").remove(),n},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}}.apply(t,r))&&(e.exports=i)},159:function(e,t,n){"use strict";var r,i;r=[n(2),n(8)],void 0!==(i=function(e,t){return{copyTextToClipboard:function(n){var r=document.createElement("textarea");r.style.position="fixed",r.style.top=0,r.style.left=0,r.style.width="2em",r.style.height="2em",r.style.padding=0,r.style.border="none",r.style.outline="none",r.style.boxShadow="none",r.style.background="transparent",document.body.appendChild(r),r.select();var i=function e(t){document.removeEventListener("copy",e);var r=t.clipboardData||window.clipboardData;r&&(r.setData("text",n),t.preventDefault())};document.addEventListener("copy",i);try{document.execCommand("copy")}catch(n){t.alert(e("Error"),e("Oops, unable to copy to clipboard"))}document.body.removeChild(r)}}}.apply(t,r))&&(e.exports=i)},195:function(e,t,n){"use strict";var r,i;r=[n(0),n(1),n(159),n(31),n(328)],void 0!==(i=function(e,t,n,r,i){var o=function(){var e=this||window,t=e.slickgrid,o=t.getColumns(),s=t.getSelectionModel().getSelectedRanges(),l=t.getData(),d=t.getSelectedRows(),c=t.CSVOptions;r.areAllRangesCompleteRows(t,s)?(e.copied_rows=d.map(function(e){return t.getDataItem(e)}),a(e.can_edit,!0)):(e.copied_rows=[],a(e.can_edit,!1));var u=i.rangesToCsv(l.getItems(),o,s,c);u&&n.copyTextToClipboard(u)},a=function(t,n){t&&e("#btn-paste-row").prop("disabled",!n)};return o}.apply(t,r))&&(e.exports=i)},2:function(e,t,n){"use strict";var r,i;r=[n(43)],void 0!==(i=function(e){return function(t,n){var r,i=e[t]?e[t]:t,o=/([^%]*)%\(([^\)]+)\)s(.*)/,a=i;do{r=!1,a=a.replace(o,function(e,t,i,o){return r=!0,t+n[i]+o})}while(r);return a}}.apply(t,r))&&(e.exports=i)},28:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),i=function(e){return e&&e.__esModule?e:{default:e}}(r);n(49),n(84),n(85),n(74),n(86),n(87),n(88),n(89),n(50),n(90),n(75),n(91),n(92),n(93),n(94),n(37),t.default=i.default},3:function(e,t,n){"use strict";var r,i,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n){i=[],r=n,void 0!==(o="function"==typeof r?r.apply(t,i):r)&&(e.exports=o)}(function(){var e=window.pgAdmin=window.pgAdmin||{};return function(e,t,n){function r(e,t,r,o){r=r||"width";var a,l,d,p=(t.match(c)||[])[2],f="px"===p?1:u[p+"toPx"],_=/r?em/i;if(f||_.test(p)&&!o)e=f?e:"rem"===p?s:"fontSize"===r?e.parentNode||e:e,f=f||parseFloat(i(e,"fontSize")),d=parseFloat(t)*f;else{a=e.style,l=a[r];try{a[r]=t}catch(e){return 0}d=a[r]?parseFloat(i(e,r)):0,a[r]=l!==n?l:null}return d}function i(e,t){var n,a,s,l,u,p=/^top|bottom/,f=["paddingTop","paddingBottom","borderTop","borderBottom"],_=4;if(n=d?d(e)[t]:(a=e.style["pixel"+t.charAt(0).toUpperCase()+t.slice(1)])?a+"px":"fontSize"===t?r(e,"1em","left",1)+"px":e.currentStyle[t],"%"===(s=(n.match(c)||[])[2])&&o)if(p.test(t)){for(l=(u=e.parentNode||e).offsetHeight;_--;)l-=parseFloat(i(u,f[_]));n=parseFloat(n)/100*l+"px"}else n=r(e,n);else("auto"===n||s&&"px"!==s)&&d?n=0:s&&"px"!==s&&!d&&(n=r(e,n)+"px");return n}var o,a=t.createElement("test"),s=t.documentElement,l=t.defaultView,d=l&&l.getComputedStyle,c=/^(-?[\d+\.\-]+)([a-z]+|%)$/i,u={},p=[1/25.4,1/2.54,1/72,1/6],f=["mm","cm","pt","pc","in","mozmm"],_=6;for(s.appendChild(a),d&&(a.style.marginTop="1%",o="1%"===d(a).marginTop);_--;)u[f[_]+"toPx"]=p[_]?p[_]*u.inToPx:r(a,"1"+f[_]);s.removeChild(a),a=n,e.toPx=r}(e,window.document),e.natural_sort=function(e,t,n){var r,i,o=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,s=/(^[ ]*|[ ]*$)/g,l=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,d=/^0x[0-9a-f]+$/i,c=/^0/,n=n||{},u=function(e){return n.insensitive&&(""+e).toLowerCase()||""+e},p=u(e).replace(s,"")||"",f=u(t).replace(s,"")||"",_=p.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),g=f.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=parseInt(p.match(d))||1!==_.length&&p.match(l)&&Date.parse(p),m=parseInt(f.match(d))||h&&f.match(l)&&Date.parse(f)||null,y=n.desc?-1:1;if(m){if(h<m)return-1*y;if(h>m)return 1*y}for(var v=0,b=Math.max(_.length,g.length);v<b;v++){if(r=!(_[v]||"").match(c)&&parseFloat(_[v])||_[v]||0,i=!(g[v]||"").match(c)&&parseFloat(g[v])||g[v]||0,isNaN(r)!==isNaN(i))return(isNaN(r)?1:-1)*y;if((void 0===r?"undefined":a(r))!==(void 0===i?"undefined":a(i))&&(r+="",i+=""),r<i)return-1*y;if(r>i)return 1*y}return 0},e})},31:function(e,t,n){"use strict";(function(r){var i,o;i=[n(77)],void 0!==(o=function(){function e(e){return r.findIndex(e.getColumns(),function(e){var t=e.pos;return!r.isUndefined(t)&&n(e)})}function t(e){return r.findLastIndex(e.getColumns(),n)}function n(e){return r.isUndefined(e.selectable)||!0===e.selectable}function i(e){var t=m(e);e.getSelectionModel().setSelectedRanges([t])}var o=window.Slick,a=function(e,t){return e.fromCell==t.fromCell&&e.toCell==t.toCell&&e.fromRow==t.fromRow&&e.toRow==t.toRow},s=function(e,t){return r.any(e,function(e){return a(e,t)})},l=function(e,t){return r.any(e,function(e){return e.fromCell<=t&&e.toCell>=t})},d=function(e,t){return r.any(e,function(e){return e.fromRow<=t&&e.toRow>=t})},c=function(e,t){return r.any(e,function(e){return e.fromCell<=t.fromCell&&e.toCell>=t.toCell&&e.fromRow<=t.fromRow&&e.toRow>=t.toRow})},u=function(e,t){return r.filter(e,function(e){return!a(e,t)})},p=function(e,t){return e.push(t),e},f=function(e,t){return r.every(e,function(e){return e.fromRow==e.toRow&&k(t,e)})},_=function(e,t){return r.every(e,C.bind(this,t))},g=function(e,t){var n=e.getColumns();return v(n)?new o.Range(t,0,t,e.getColumns().length-1):new o.Range(t,1,t,e.getColumns().length-1)},h=function(e,t){return new o.Range(0,t,e.getDataLength()-1,t)},m=function(e){return new o.Range(0,1,e.getDataLength()-1,e.getColumns().length-1)},y=function(e){var t=e.getSelectionModel(),n=t.getSelectedRanges();return 1==n.length&&a(n[0],m(e))},v=function(e){return!r.isUndefined(e[0].pos)},b=function(e,t){return r.every(t,function(t){return S(e,t)})},w=function(e,t){return r.every(t,function(t){return k(e,t)})},x=function(e,t){var n=[];return t.forEach(function(t){k(e,t)&&(n=n.concat(r.range(t.fromRow,t.toRow+1)))}),n},C=function(e,t){return t.fromCell==t.toCell&&0==t.fromRow&&t.toRow==e.getDataLength()-1},S=function(e,t){return 0===t.fromRow&&t.toRow===e.getDataLength()-1},k=function(n,r){return r.fromCell===e(n)&&r.toCell===t(n)};return{addRange:p,removeRange:u,isRangeSelected:s,areAllRangesSingleRows:f,areAllRangesSingleColumns:_,areAllRangesCompleteRows:w,areAllRangesCompleteColumns:b,rangeForRow:g,rangeForColumn:h,isEntireGridSelected:y,getRangeOfWholeGrid:m,isFirstColumnData:v,getIndexesOfCompleteRows:x,selectAll:i,isRangeAColumn:C,rangeHasCompleteColumns:S,rangeHasCompleteRows:k,isAnyCellOfColumnSelected:l,isRangeEntirelyWithinSelectedRanges:c,isAnyCellOfRowSelected:d}}.apply(t,i))&&(e.exports=o)}).call(t,n(1))},321:function(e,t,n){"use strict";var r,i,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=[n(182),n(2),n(5),n(0),n(1),n(4),n(15),n(3),n(10),n(28),n(322),n(324),n(327),n(159),n(195),n(31),n(483),n(329),n(330),n(158),n(331),n(333),n(23),n(98),n(468),n(469),n(470),n(186),n(480),n(481),n(482),n(6)],void 0!==(i=function(e,t,n,r,i,a,s,l,d,c,u,p,f,_,g,h,m,y,v,b,w,x,C,S,k,E){if(l.SqlEditor)return l.SqlEditor;var q=window.wcDocker,O=l.Browser,R=c.default,T=window.Slick,P=!1,N=d.View.extend({initialize:function(e){this.$el=e.el,this.handler=e.handler,this.handler.col_size={}},events:{"click .btn-load-file":"on_file_load","click #btn-save":"on_save","click #btn-file-menu-save":"on_save","click #btn-file-menu-save-as":"on_save_as","click #btn-find":"on_find","click #btn-find-menu-find":"on_find","click #btn-find-menu-find-next":"on_find_next","click #btn-find-menu-find-previous":"on_find_previous","click #btn-find-menu-replace":"on_replace","click #btn-find-menu-replace-all":"on_replace_all","click #btn-find-menu-find-persistent":"on_find_persistent","click #btn-find-menu-jump":"on_jump","click #btn-delete-row":"on_delete","click #btn-filter":"on_show_filter","click #btn-filter-menu":"on_show_filter","click #btn-include-filter":"on_include_filter","click #btn-exclude-filter":"on_exclude_filter","click #btn-remove-filter":"on_remove_filter","click #btn-apply":"on_apply","click #btn-cancel":"on_cancel","click #btn-copy-row":"on_copy_row","click #btn-paste-row":"on_paste_row","click #btn-flash":"on_flash","click #btn-flash-menu":"on_flash","click #btn-cancel-query":"on_cancel_query","click #btn-download":"on_download","click #btn-edit":"on_clear","click #btn-clear":"on_clear","click #btn-auto-commit":"on_auto_commit","click #btn-auto-rollback":"on_auto_rollback","click #btn-clear-history":"on_clear_history","click .noclose":"do_not_close_menu","click #btn-explain":"on_explain","click #btn-explain-analyze":"on_explain_analyze","click #btn-explain-verbose":"on_explain_verbose","click #btn-explain-costs":"on_explain_costs","click #btn-explain-buffers":"on_explain_buffers","click #btn-explain-timing":"on_explain_timing","change .limit":"on_limit_change",keydown:"keyAction","click #btn-comment-code":"on_toggle_comment_block_code","click #btn-toggle-comment-block":"on_toggle_comment_block_code","click #btn-comment-line":"on_comment_line_code","click #btn-uncomment-line":"on_uncomment_line_code","click #btn-indent-code":"on_indent_code","click #btn-unindent-code":"on_unindent_code"},render:function(){var e=this,o=e.$el.find("#sql_filter");r(".editor-title").text(i.unescape(e.editor_title)),e.filter_obj=R.fromTextArea(o.get(0),{lineNumbers:!0,mode:"gpdb"===e.handler.server_type?"text/x-gpsql":"text/x-pgsql",foldOptions:{widget:"…"},foldGutter:{rangeFinder:R.fold.combine(R.pgadminBeginRangeFinder,R.pgadminIfRangeFinder,R.pgadminLoopRangeFinder,R.pgadminCaseRangeFinder)},gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:O.editor_shortcut_keys,indentWithTabs:l.Browser.editor_options.indent_with_tabs,indentUnit:l.Browser.editor_options.tabSize,tabSize:l.Browser.editor_options.tabSize,lineWrapping:l.Browser.editor_options.wrapCode,autoCloseBrackets:l.Browser.editor_options.insert_pair_brackets,matchBrackets:l.Browser.editor_options.brace_matching});var a=new q("#editor-panel",{allowContextMenu:!1,allowCollapse:!1,themePath:n("static",{filename:"css"}),theme:"webcabin.overrides.css"});new l.Browser.Panel({name:"sql_panel",title:!1,width:"100%",height:"20%",isCloseable:!1,isPrivate:!0}).load(a);var s=a.addPanel("sql_panel",q.DOCK.TOP),d=r('<textarea id="sql_query_tool"></textarea>'),c=r('<div id="output-panel"></div>').append(d);s.$container.find(".pg-panel-content").append(c),e.query_tool_obj=R.fromTextArea(d.get(0),{lineNumbers:!0,styleSelectedText:!0,mode:"gpdb"===e.handler.server_type?"text/x-gpsql":"text/x-pgsql",foldOptions:{widget:"…"},foldGutter:{rangeFinder:R.fold.combine(R.pgadminBeginRangeFinder,R.pgadminIfRangeFinder,R.pgadminLoopRangeFinder,R.pgadminCaseRangeFinder)},gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:O.editor_shortcut_keys,indentWithTabs:l.Browser.editor_options.indent_with_tabs,indentUnit:l.Browser.editor_options.tabSize,tabSize:l.Browser.editor_options.tabSize,lineWrapping:l.Browser.editor_options.wrapCode,scrollbarStyle:"simple",autoCloseBrackets:l.Browser.editor_options.insert_pair_brackets,matchBrackets:l.Browser.editor_options.brace_matching}),s.on(q.EVENT.RESIZE_ENDED,function(){setTimeout(function(){e&&e.query_tool_obj&&e.query_tool_obj.refresh()},200)});var u=new l.Browser.Panel({name:"data_output",title:t("Data Output"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,content:'<div id ="datagrid" class="sql-editor-grid-container text-12"></div>'}),p=new l.Browser.Panel({name:"explain",title:t("Explain"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,content:'<div class="sql-editor-explain"></div>'}),f=new l.Browser.Panel({name:"messages",title:t("Messages"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,content:'<div class="sql-editor-message"></div>'}),_=new l.Browser.Panel({name:"history",title:t("Query History"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,content:'<div id ="history_grid" class="sql-editor-history-container"></div>'});u.load(a),p.load(a),f.load(a),_.load(a),e.data_output_panel=a.addPanel("data_output",q.DOCK.BOTTOM,s),e.explain_panel=a.addPanel("explain",q.DOCK.STACKED,e.data_output_panel),e.messages_panel=a.addPanel("messages",q.DOCK.STACKED,e.data_output_panel),e.history_panel=a.addPanel("history",q.DOCK.STACKED,e.data_output_panel),e.render_history_grid(),e.handler.is_new_browser_tab||i.each(window.top.pgAdmin.Browser.docker.findPanels("frm_datagrid"),function(n){n.isVisible()&&(e.handler.prompt_save_changes&&n.on(q.EVENT.CLOSING,function(){var r,o=!1;if(e.handler.can_edit){var a=e.handler.data_store;a&&(i.size(a.added)||i.size(a.updated))&&(r=t("The data has changed. Do you want to save changes?"),o=!0)}else e.handler.is_query_tool&&e.handler.is_query_changed&&(r=t("The text has changed. Do you want to save changes?"),o=!0);return!o||e.user_confirmation(n,r)}),n.on(q.EVENT.GAIN_FOCUS,function(){r(n.$container).hasClass("wcPanelTabContentHidden")||setTimeout(function(){e.handler.gridView.query_tool_obj.focus()},200)}))}),setTimeout(function(){e.query_tool_obj.focus()},500),R.registerHelper("hint","sql",function(t,o){var a=[],s=t.getDoc(),l=s.getCursor(),d=l.ch,c={editor:t,url:n("sqleditor.autocomplete",{trans_id:e.transId}),data:a,current_line:l.line,hint_render:function(e,t,n){var r=document.createElement("span");switch(n.type){case"database":r.className="sqleditor-hint pg-icon-"+n.type;break;case"datatype":r.className="sqleditor-hint icon-type";break;case"keyword":r.className="fa fa-key";break;case"table alias":r.className="fa fa-at";break;default:r.className="sqleditor-hint icon-"+n.type}r.appendChild(document.createTextNode(n.text)),e.appendChild(r)}};return a.push(s.getValue()),a.push(s.getRange({line:0,ch:0},{line:c.current_line,ch:d})),{then:function(e){var t=this;r.ajax({url:t.url,method:"POST",contentType:"application/json",data:JSON.stringify(t.data),success:function(n){var r=[];i.each(n.data.result,function(e,n){r.push({text:n,type:e.object_type,render:t.hint_render})}),r.sort(function(e,t){var n=e.text.toLowerCase(),r=t.text.toLowerCase();return n<r?-1:n>r?1:0});var o,a,s,d=t.editor.getTokenAt(l);d.end>l.ch&&(d.end=l.ch,d.string=d.string.slice(0,l.ch-d.start)),d.string.match(/^[.`\w@]\w*$/)?(s=d.string,o=d.start,a=d.end):(o=a=l.ch,s=""),"."!=s.charAt(0)&&"``"!=s.charAt(0)||(o+=1),e({list:r,from:{line:t.current_line,ch:o},to:{line:t.current_line,ch:a}})}})}.bind(c)}})},user_confirmation:function(e,n){var r=this;return s.confirmSave||s.dialog("confirmSave",function(){return{main:function(e,n){t("The text has changed. Do you want to save changes?");this.setHeader(e),this.setContent(n)},setup:function(){return{buttons:[{text:t("Save"),className:"btn btn-primary"},{text:t("Don't save"),className:"btn btn-danger"},{text:t("Cancel"),key:27,invokeOnClose:!0,className:"btn btn-warning"}],focus:{element:0,select:!1},options:{maximizable:!1,resizable:!1}}},callback:function(e){switch(e.index){case 0:r.handler.close_on_save=!0,r.handler._save(r,r.handler);break;case 1:r.handler.close_on_save=!1,r.handler.close()}}}}),s.confirmSave(t("Save changes?"),n),!1},render_grid:function(e,t,n,o,a){var s=this;s.handler.data_store={updated:{},added:{},staged_rows:{},deleted:{},updated_index:{},added_index:{}},s.handler.primary_keys_data={},s.client_primary_key=o,s.client_primary_key_counter=0,s.handler.slickgrid&&s.handler.slickgrid.destroy(),i.isArray(e)&&i.size(e)||(e=[]);var l,d=[],c=s.handler.col_size,u=s.handler.query,_=u.match(/select.*from\s+\w+\.*(\w+)/i);l=_?_[1]:b.getHash(u),s.handler.table_name=l,c[l]=c[l]||{};r(r("#editor-panel").find(".wcFrame")[1]).width();i.each(t,function(e){var t={id:e.name,pos:e.pos,field:e.name,name:e.label,display_name:e.display_name,column_type:e.column_type,column_type_internal:e.column_type_internal,not_null:e.not_null,has_default_val:e.has_default_val,is_array:e.is_array},o=e.column_type.trim(),a=e.name.length>o.length?e.name:o;i.isUndefined(c[l][e.name])?(t.width=b.calculateColumnWidth(a),c[l][e.name]=t.width):t.width=c[l][e.name],"oid"==e.cell?t.editor=null:"Json"==e.cell?(t.editor=n?T.Editors.JsonText:T.Editors.ReadOnlyJsonText,t.formatter=T.Formatters.JsonString):"number"==e.cell||-1!==r.inArray(e.type,["oid","xid","real"])?(t.editor=n?T.Editors.CustomNumber:T.Editors.ReadOnlyText,t.formatter=T.Formatters.Numbers):"boolean"==e.cell?(t.editor=n?T.Editors.Checkbox:T.Editors.ReadOnlyCheckbox,t.formatter=T.Formatters.Checkmark):"binary"==e.cell?t.formatter=T.Formatters.Binary:(t.editor=n?T.Editors.pgText:T.Editors.ReadOnlypgText,t.formatter=T.Formatters.Text),d.push(t)});var g=new p;d=s.grid_columns=g.getColumnDefinitions(d),a&&(d[0].width=b.calculateColumnWidth(a));var h={editable:!0,enableAddRow:n,enableCellNavigation:!0,enableColumnReorder:!1,asyncEditorLoading:!1,autoEdit:!1},w=s.$el.find("#datagrid"),x=r(r("#editor-panel").find(".wcFrame")[1]).height()-35;w.height(x);var C=s.dataView=new T.Data.DataView,S=s.grid=new T.Grid(w,C,d,h);C.getItemMetadata=function(e){var t="",n=s.handler.data_store;return i.has(s.handler,"data_store")&&(e in n.added_index&&n.added_index[e]in n.added?(t="new_row",n.added[n.added_index[e]].err&&(t+=" error")):e in n.updated_index&&e in n.updated&&(t="updated_row",n.updated[n.updated_index[e]].err&&(t+=" error"))),!i.isUndefined(s.handler.rows_to_disable)&&s.handler.rows_to_disable.length>0&&-1!==i.indexOf(s.handler.rows_to_disable,e)&&(t+=" disabled_row"),{cssClasses:t}},S.registerPlugin(new T.AutoTooltips({enableForHeaderCells:!1})),S.registerPlugin(new f),S.setSelectionModel(new y),S.registerPlugin(g);var k={keys:i.isEmpty(s.handler.primary_keys)&&s.handler.has_oids?s.handler.oids:s.handler.primary_keys,vals:e,columns:t,grid:S,selection:S.getSelectionModel(),editor:s,client_primary_key:s.client_primary_key,has_oids:s.handler.has_oids};s.handler.slickgrid=S,k.selection&&k.selection.onSelectedRangesChanged.subscribe(v.bind(k)),S.onColumnsResized.subscribe(function(e,t){var n=this.getColumns();i.each(n,function(e,t){s.handler.col_size[s.handler.table_name][e.id]=e.width})}),g.onBeforeGridSelectAll.subscribe(function(e,t){s.handler.has_more_rows&&(e.stopImmediatePropagation(),s.fetch_next_all(function(){g.onGridSelectAll.notify(t,new T.EventData)}))}),g.onBeforeGridColumnSelectAll.subscribe(function(e,t){s.handler.has_more_rows&&(e.stopImmediatePropagation(),s.fetch_next_all(function(){g.onGridColumnSelectAll.notify(t,new T.EventData)}))}),C.onRowCountChanged.subscribe(function(e,t){S.updateRowCount(),S.render()}),C.onRowsChanged.subscribe(function(e,t){S.invalidateRows(t.rows),S.render()}),S.onBeforeEditCell.subscribe(function(e,t){if("bytea"==t.column.column_type_internal||"bytea[]"==t.column.column_type_internal)return!1;var n=t.item;if(s.handler.rows_to_disable&&i.contains(s.handler.rows_to_disable,t.row))return!1;if(s.handler.can_edit&&n&&s.client_primary_key in n){var r=n[s.client_primary_key],o=s.handler.primary_keys,a={};if(r in s.handler.primary_keys_data)return;s.handler.columns;i.each(o,function(e,t){a[t]=n[t]}),s.handler.primary_keys_data[r]=a}}),S.onKeyDown.subscribe(function(e,t){var n=e.keyCode;if((e.ctrlKey||e.metaKey)&&65==n&&s.handler.has_more_rows)s.fetch_next_all(function(){m(e,t)});else{var r=void 0;t.grid.CSVOptions={},r=s.handler.is_new_browser_tab?window.opener.pgAdmin.Browser.preferences_cache:window.top.pgAdmin.Browser.preferences_cache,t.grid.CSVOptions.quoting=i.findWhere(r,{module:"sqleditor",name:"results_grid_quoting"}).value,t.grid.CSVOptions.quote_char=i.findWhere(r,{module:"sqleditor",name:"results_grid_quote_char"}).value,t.grid.CSVOptions.field_separator=i.findWhere(r,{module:"sqleditor",name:"results_grid_field_separator"}).value,m(e,t)}}),S.onCellChange.subscribe(function(e,t){var n=t.grid.getColumns()[t.cell].field,o=t.item[n],a=t.item[s.client_primary_key]||null,l=(s.handler.has_oids,{}),d=t.grid,c=d.getDataItem(t.row);if(s.primary_keys&&i.all(i.values(i.pick(c,s.primary_keys)),function(e){return void 0!=e})&&s.handler.temp_new_rows){var u=s.handler.temp_new_rows.indexOf(t.row);u>-1&&s.handler.temp_new_rows.splice(u,1)}l[n]=o,a&&(a in s.handler.data_store.added?(i.extend(s.handler.data_store.added[a].data,l),s.handler.data_store.added[a].err=!1):a in s.handler.data_store.updated?(i.extend(s.handler.data_store.updated[a].data,l),s.handler.data_store.updated[a].err=!1):(s.handler.data_store.updated[a]={err:!1,data:l,primary_keys:s.handler.primary_keys_data[a]},s.handler.data_store.updated_index[t.row]=a)),r("#btn-save").prop("disabled",!1)}.bind(k)),S.onAddNewRow.subscribe(function(e,t){var n=t.column,o=t.item,a=this.grid.getDataLength(),l=(s.client_primary_key_counter++).toString(),d=this.grid.getData();i.isUndefined(o[0])&&s.handler.temp_new_rows.push(a),o&&(o[s.client_primary_key]=l),d.addItem(o),s.handler.data_store.added[l]={err:!1,data:o},s.handler.data_store.added_index[a]=l,{}[n.name]=i.where(this.columns,{pos:n.pos})[0].type,S.updateRowCount(),S.render(),r("#btn-save").prop("disabled",!1)}.bind(k)),S.onViewportChanged.subscribe(function(e,t){var n=t.grid.getRenderedRange(),r=t.grid.getDataLength();s.handler.has_more_rows&&!s.handler.fetching_rows&&n.bottom>r-100&&setTimeout(s.fetch_next.bind(s))}),r(window).resize(function(){s.data_output_panel.isVisible()&&s.grid_resize(S)}),s.data_output_panel.on(q.EVENT.RESIZE_ENDED,function(){s.data_output_panel.isVisible()&&s.grid_resize(S)}),s.data_output_panel.on(q.EVENT.VISIBILITY_CHANGED,function(){s.data_output_panel.isVisible()&&s.grid_resize(S)});for(var E=0;E<e.length;E++){for(var O={},R=1;R<d.length;R++)O[d[R].field]=e[E][d[R].pos];O[s.client_primary_key]=(s.client_primary_key_counter++).toString(),e[E]=O}C.setItems(e,s.client_primary_key)},fetch_next_all:function(e){this.fetch_next(!0,e)},fetch_next:function(e,i){var o=this,a="";o.handler.fetching_rows=!0,r("#btn-flash").prop("disabled",!0),e?(o.handler.trigger("pgadmin-sqleditor:loading-icon:show",t("Fetching all records...")),a=n("sqleditor.fetch_all",{trans_id:o.transId,fetch_all:1})):a=a=n("sqleditor.fetch",{trans_id:o.transId}),r.ajax({url:a,method:"GET",success:function(e){o.handler.has_more_rows=e.data.has_more_rows,r("#btn-flash").prop("disabled",!1),o.handler.trigger("pgadmin-sqleditor:loading-icon:hide"),o.update_grid_data(e.data.result),o.handler.fetching_rows=!1,"function"==typeof i&&i()},error:function(e){if(r("#btn-flash").prop("disabled",!1),o.handler.trigger("pgadmin-sqleditor:loading-icon:hide"),o.handler.has_more_rows=!1,o.handler.fetching_rows=!1,"function"==typeof i&&i(),0==e.readyState)return void o.update_msg_history(!1,t("Not connected to the server or the connection to the server has been closed."))}})},update_grid_data:function(e){this.dataView.beginUpdate();for(var t=0;t<e.length;t++){for(var n={},r=1;r<this.grid_columns.length;r++)n[this.grid_columns[r].field]=e[t][this.grid_columns[r].pos];n[this.client_primary_key]=(this.client_primary_key_counter++).toString(),this.dataView.addItem(n)}this.dataView.endUpdate()},grid_resize:function(e){var t=r("#datagrid").height(),n=r(r("#editor-panel").find(".wcFrame")[1]).height()-35,i=e.getViewport(),o=e.getRenderedRange(),a=e.getActiveCell();t!=n&&r("#datagrid").css({height:n+"px"}),e.resizeCanvas(),a&&e.scrollCellIntoView(a.row,a.cell),i.top!=o.top&&(i.bottom-2==o.bottom?e.scrollRowIntoView(i.bottom):e.scrollRowIntoView(i.bottom-2))},render_history_grid:function(){var e=this;e.history_collection=new w.HistoryCollection([]);var t,n=C.createElement(x.QueryHistory,{historyCollection:e.history_collection,ref:function(e){t=e}});S.render(n,r("#history_grid")[0]),e.history_panel.on(q.EVENT.VISIBILITY_CHANGED,function(){t.refocus()})},on_delete:function(){var e=this;e.handler.trigger("pgadmin-sqleditor:button:deleterow",e,e.handler)},_stopEventPropogation:function(e){e=e||window.event,e.cancelBubble=!0,e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()},_closeDropDown:function(e){var t=e&&(e.currentTarget||e.target);t&&r(t).closest(".open").removeClass("open").find(".dropdown-backdrop").remove()},on_save:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.handler.close_on_save=!1,t.handler.trigger("pgadmin-sqleditor:button:save",t,t.handler)},on_save_as:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.handler.close_on_save=!1,t.handler.trigger("pgadmin-sqleditor:button:save",t,t.handler,!0)},on_find:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.query_tool_obj.execCommand("find")},on_find_next:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.query_tool_obj.execCommand("findNext")},on_find_previous:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.query_tool_obj.execCommand("findPrev")},on_replace:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.query_tool_obj.execCommand("replace")},on_replace_all:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.query_tool_obj.execCommand("replaceAll")},on_find_persistent:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.query_tool_obj.execCommand("findPersistent")},on_jump:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.query_tool_obj.execCommand("jumpToLine")},on_show_filter:function(){var e=this;e.handler.trigger("pgadmin-sqleditor:button:show_filter",e,e.handler)},on_include_filter:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.handler.trigger("pgadmin-sqleditor:button:include_filter",t,t.handler)},on_exclude_filter:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.handler.trigger("pgadmin-sqleditor:button:exclude_filter",t,t.handler)},on_remove_filter:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.handler.trigger("pgadmin-sqleditor:button:remove_filter",t,t.handler)},on_apply:function(){var e=this;e.handler.trigger("pgadmin-sqleditor:button:apply_filter",e,e.handler)},on_cancel:function(){r("#filter").addClass("hidden"),r("#editor-panel").removeClass("sql-editor-busy-fetching")},on_copy_row:function(){var e=this,t=void 0;e.grid.CSVOptions={},t=e.handler.is_new_browser_tab?window.opener.pgAdmin.Browser.preferences_cache:window.top.pgAdmin.Browser.preferences_cache,e.grid.CSVOptions.quoting=i.findWhere(t,{module:"sqleditor",name:"results_grid_quoting"}).value,e.grid.CSVOptions.quote_char=i.findWhere(t,{module:"sqleditor",name:"results_grid_quote_char"}).value,e.grid.CSVOptions.field_separator=i.findWhere(t,{module:"sqleditor",name:"results_grid_field_separator"}).value,e.handler.trigger("pgadmin-sqleditor:button:copy_row",e,e.handler)},on_paste_row:function(){var e=this;e.handler.trigger("pgadmin-sqleditor:button:paste_row",e,e.handler)},on_limit_change:function(){var e=this;e.handler.trigger("pgadmin-sqleditor:button:limit",e,e.handler)},on_flash:function(){E.executeQuery(this.handler)},on_cancel_query:function(){var e=this;e.handler.trigger("pgadmin-sqleditor:button:cancel-query",e,e.handler)},on_comment_line_code:function(){E.commentLineCode(this.handler)},on_uncomment_line_code:function(){E.uncommentLineCode(this.handler)},on_toggle_comment_block_code:function(){E.commentBlockCode(this.handler)},on_indent_code:function(){var e=this;e.handler.trigger("pgadmin-sqleditor:indent_selected_code",e,e.handler)},on_unindent_code:function(){var e=this;e.handler.trigger("pgadmin-sqleditor:unindent_selected_code",e,e.handler)},on_clear:function(e){var n=this;this._stopEventPropogation(e),this._closeDropDown(e),n.handler.is_query_changed?s.confirm(t("Unsaved changes"),t("Are you sure you wish to discard the current changes?"),function(){n.query_tool_obj.setValue("")},function(){return!0}).set("labels",{ok:"Yes",cancel:"No"}):n.query_tool_obj.setValue("")},on_clear_history:function(e){var n=this;this._stopEventPropogation(e),this._closeDropDown(e),n.history_collection.length()&&s.confirm(t("Clear history"),t("Are you sure you wish to clear the history?"),function(){n.history_collection&&n.history_collection.reset()},function(){return!0}).set("labels",{ok:"Yes",cancel:"No"})},on_auto_commit:function(e){var t=this;this._stopEventPropogation(e),t.handler.trigger("pgadmin-sqleditor:button:auto_commit",t,t.handler)},on_auto_rollback:function(e){var t=this;this._stopEventPropogation(e),t.handler.trigger("pgadmin-sqleditor:button:auto_rollback",t,t.handler)},on_explain:function(e){this._stopEventPropogation(e),this._closeDropDown(e),E.explain(this.handler)},on_explain_analyze:function(e){this._stopEventPropogation(e),this._closeDropDown(e),E.explainAnalyze(this.handler)},on_explain_verbose:function(e){var t=this;this._stopEventPropogation(e),t.handler.trigger("pgadmin-sqleditor:button:explain-verbose",t,t.handler)},on_explain_costs:function(e){var t=this;this._stopEventPropogation(e),t.handler.trigger("pgadmin-sqleditor:button:explain-costs",t,t.handler)},on_explain_buffers:function(e){var t=this;this._stopEventPropogation(e),t.handler.trigger("pgadmin-sqleditor:button:explain-buffers",t,t.handler)},on_explain_timing:function(e){var t=this;this._stopEventPropogation(e),t.handler.trigger("pgadmin-sqleditor:button:explain-timing",t,t.handler)},do_not_close_menu:function(e){e.stopPropagation()},on_file_load:function(e){var t=this;this._stopEventPropogation(e),this._closeDropDown(e),t.handler.trigger("pgadmin-sqleditor:button:load_file",t,t.handler)},on_download:function(){E.download(this.handler)},keyAction:function(e){k.processEvent(this.handler,E,e)}}),j=function(e,t){this.initialize.apply(this,arguments)};return i.extend(j.prototype,d.Events,{initialize:function(e,t){this.container=e},start:function(e,t,n,r,o,a){var s=this;if(s.is_query_tool=e,s.rows_affected=0,s.marked_line_no=0,s.explain_verbose=!1,s.explain_costs=!1,s.explain_buffers=!1,s.explain_timing=!1,s.is_new_browser_tab=r,s.has_more_rows=!1,s.fetching_rows=!1,s.close_on_save=!1,s.server_type=o,s.prompt_save_changes=a,!s.gridView)if(s.gridView=new N({el:s.container,handler:s}),s.transId=s.gridView.transId=s.container.data("transId"),s.gridView.editor_title=i.unescape(t),s.gridView.current_file=void 0,s.gridView.render(),l.Browser.Events.on("pgadmin-storage:finish_btn:select_file",s._select_file_handler,s),l.Browser.Events.on("pgadmin-storage:finish_btn:create_file",s._save_file_handler,s),s.is_query_tool&&(s.get_preferences(),s.gridView.query_tool_obj.on("change",s._on_query_change.bind(s))),s.on("pgadmin-sqleditor:button:load_file",s._load_file,s),s.on("pgadmin-sqleditor:button:save",s._save,s),s.on("pgadmin-sqleditor:button:deleterow",s._delete,s),s.on("pgadmin-sqleditor:button:show_filter",s._show_filter,s),s.on("pgadmin-sqleditor:button:include_filter",s._include_filter,s),s.on("pgadmin-sqleditor:button:exclude_filter",s._exclude_filter,s),s.on("pgadmin-sqleditor:button:remove_filter",s._remove_filter,s),s.on("pgadmin-sqleditor:button:apply_filter",s._apply_filter,s),s.on("pgadmin-sqleditor:button:copy_row",s._copy_row,s),s.on("pgadmin-sqleditor:button:paste_row",s._paste_row,s),s.on("pgadmin-sqleditor:button:limit",s._set_limit,s),s.on("pgadmin-sqleditor:button:cancel-query",s._cancel_query,s),s.on("pgadmin-sqleditor:button:auto_rollback",s._auto_rollback,s),s.on("pgadmin-sqleditor:button:auto_commit",s._auto_commit,s),s.on("pgadmin-sqleditor:button:explain-verbose",s._explain_verbose,s),s.on("pgadmin-sqleditor:button:explain-costs",s._explain_costs,s),s.on("pgadmin-sqleditor:button:explain-buffers",s._explain_buffers,s),s.on("pgadmin-sqleditor:button:explain-timing",s._explain_timing,s),s.on("pgadmin-sqleditor:indent_selected_code",s._indent_selected_code,s),s.on("pgadmin-sqleditor:unindent_selected_code",s._unindent_selected_code,s),s.is_query_tool)s.gridView.query_tool_obj.refresh(),n&&""!==n&&s.gridView.query_tool_obj.setValue(n);else{s.gridView.query_tool_obj.setOption("readOnly","nocursor");var d=s.gridView.query_tool_obj.getWrapperElement();d&&(d.className+=" bg-gray-1 opacity-5"),s.disable_tool_buttons(!0),s.execute_data_query()}},execute_data_query:function(){var e=this;i.has(e,"data_store")&&(i.size(e.data_store.added)||i.size(e.data_store.updated)||i.size(e.data_store.deleted))?s.confirm(t("Unsaved changes"),t("The data has been modified, but not saved. Are you sure you wish to discard the changes?"),function(){e._run_query()},function(){return!0}).set("labels",{ok:"Yes",cancel:"No"}):e._run_query()},_run_query:function(){var e=this;e.query_start_time=new Date,e.rows_affected=0,e._init_polling_flags(),e.rows_to_disable=new Array,e.temp_new_rows=new Array,e.has_more_rows=!1,e.fetching_rows=!1,e.trigger("pgadmin-sqleditor:loading-icon:show",t("Initializing query execution.")),r("#btn-flash").prop("disabled",!0),e.trigger("pgadmin-sqleditor:loading-icon:message",t("Waiting for the query execution to complete...")),r.ajax({url:n("sqleditor.view_data_start",{trans_id:e.transId}),method:"GET",success:function(t){t.data.status?(e.can_edit=t.data.can_edit,e.can_filter=t.data.can_filter,e.info_notifier_timeout=t.data.info_notifier_timeout,e.gridView.query_tool_obj.setValue(t.data.sql),e.query=t.data.sql,e.can_filter&&t.data.filter_applied?(r("#btn-filter").removeClass("btn-default"),r("#btn-filter-dropdown").removeClass("btn-default"),r("#btn-filter").addClass("btn-warning"),r("#btn-filter-dropdown").addClass("btn-warning")):(r("#btn-filter").removeClass("btn-warning"),r("#btn-filter-dropdown").removeClass("btn-warning"),r("#btn-filter").addClass("btn-default"),r("#btn-filter-dropdown").addClass("btn-default")),r("#btn-save").prop("disabled",!0),r("#btn-file-menu-dropdown").prop("disabled",!0),r("#btn-copy-row").prop("disabled",!0),r("#btn-paste-row").prop("disabled",!0),r(".limit").val(t.data.limit),e._poll()):(e.trigger("pgadmin-sqleditor:loading-icon:hide"),e.update_msg_history(!1,t.data.result))},error:function(n){if(e.trigger("pgadmin-sqleditor:loading-icon:hide"),0==n.readyState)return void e.update_msg_history(!1,t("Not connected to the server or the connection to the server has been closed."));var r=n.responseText;void 0!=n.responseJSON&&void 0!=n.responseJSON.errormsg&&(r=n.responseJSON.errormsg),e.update_msg_history(!1,r)}})},call_render_after_poll:function(e){var n=this;if(n.query_end_time=new Date,n.rows_affected=e.rows_affected,n.has_more_rows=e.has_more_rows,null!=e.colinfo)n._render(e);else{n.total_time=n.get_query_run_time(n.query_start_time,n.query_end_time);var i=a(t("Query returned successfully in %s.")).sprintf(n.total_time).value();e.result+="\n\n"+i,n.update_msg_history(!0,e.result,!1),n.info_notifier_timeout>=0&&s.success(i,n.info_notifier_timeout)}n.is_query_tool&&(n.disable_tool_buttons(!1),r("#btn-cancel-query").prop("disabled",!0)),P=!1,n.trigger("pgadmin-sqleditor:loading-icon:hide")},_poll:function(){var e=this;setTimeout(function(){r.ajax({url:n("sqleditor.poll",{trans_id:e.transId}),method:"GET",success:function(n){"Success"===n.data.status?(e.trigger("pgadmin-sqleditor:loading-icon:message",t("Loading data from the database server and rendering...")),e.call_render_after_poll(n.data)):"Busy"===n.data.status?(e._poll(),P=!0,n.data.result&&e.update_msg_history(n.data.status,n.data.result,!1)):"NotConnected"===n.data.status?(e.trigger("pgadmin-sqleditor:loading-icon:hide"),e.is_query_tool&&(e.disable_tool_buttons(!1),r("#btn-cancel-query").prop("disabled",!0)),e.update_msg_history(!1,n.data.result,!0)):"Cancel"===n.data.status&&(e.trigger("pgadmin-sqleditor:loading-icon:hide"),e.update_msg_history(!1,"Execution Cancelled!",!0))},error:function(n){if(e.resetQueryHistoryObject(e),e.trigger("pgadmin-sqleditor:loading-icon:hide"),e.is_query_tool&&(e.disable_tool_buttons(!1),r("#btn-cancel-query").prop("disabled",!0)),0==n.readyState)return void e.update_msg_history(!1,t("Not connected to the server or the connection to the server has been closed."));var i=n.responseText;void 0!=n.responseJSON&&void 0!=n.responseJSON.errormsg&&(i=n.responseJSON.errormsg),e.update_msg_history(!1,i),e._highlight_error(i)}})},e.POLL_FALLBACK_TIME())},_render:function(e){var n=this;n.colinfo=e.col_info,n.primary_keys=i.isEmpty(e.primary_keys)&&e.has_oids?e.oids:e.primary_keys,n.client_primary_key=e.client_primary_key,n.cell_selected=!1,n.selected_model=null,n.changedModels=[],n.has_oids=e.has_oids,n.oids=e.oids,r(".sql-editor-explain").empty(),null!==n.primary_keys&&void 0!==n.primary_keys&&0!==i.size(n.primary_keys)||0!=n.has_oids?n.can_edit=!0:n.can_edit=!1,n.can_filter&&(r(".limit").prop("disabled",!1),r(".limit").addClass("limit-enabled"),r("#btn-filter").prop("disabled",!1),r("#btn-filter-dropdown").prop("disabled",!1)),r("#btn-delete-row").prop("disabled",!0),n.is_query_tool||n.can_edit||(r("#btn-save").prop("disabled",!0),r("#btn-file-menu-dropdown").prop("disabled",!0)),n.can_edit||(r("#btn-delete-row").prop("disabled",!0),r("#btn-copy-row").prop("disabled",!0),r("#btn-paste-row").prop("disabled",!0)),n._fetch_column_metadata.call(n,e,function(){var n=this;n.trigger("pgadmin-sqleditor:loading-icon:message",t("Loading data from the database server and rendering..."),n),n.total_time=n.get_query_run_time(n.query_start_time,n.query_end_time);var o=a(t("Successfully run. Total query runtime: %s.")).sprintf(n.total_time).value(),l=a(t("%s rows affected.")).sprintf(n.rows_affected).value();n.info_notifier_timeout>=0&&s.success(o+" "+l,n.info_notifier_timeout);var d=o+"\n"+l;i.isNull(e.additional_messages)||i.isUndefined(e.additional_messages)||(d=e.additional_messages+"\n"+d),n.update_msg_history(!0,d,!1);var c=[];if(e.result&&e.result.length>=1&&e.result[0]&&e.result[0][0]&&e.result[0][0][0]&&e.result[0][0][0].hasOwnProperty("Plan")&&i.isObject(e.result[0][0][0].Plan)){var p=[JSON.stringify(e.result[0][0],null,2)];c.push(p),n.gridView.data_output_panel.focus(),setTimeout(function(){n.gridView.render_grid(c,n.columns,n.can_edit,n.client_primary_key),n.gridView.explain_panel.focus(),u.DrawJSONPlan(r(".sql-editor-explain"),e.result[0][0])},10)}else n.gridView.data_output_panel.focus(),setTimeout(function(){n.gridView.render_grid(e.result,n.columns,n.can_edit,n.client_primary_key,e.rows_affected)},10);n.trigger("pgadmin-sqleditor:loading-icon:hide"),r("#btn-flash").prop("disabled",!1)}.bind(n))},_fetch_column_metadata:function(e,t){var n=e.colinfo,r=e.primary_keys,o=(e.result,[]),a=this,s=new Array;i.each(e.types,function(e){s[e.oid]=[e.typname]}),i.each(n,function(e){var t=!1;i.size(r)>0&&i.each(r,function(n,r){r===e.name&&(t=!0)});var n,l="",d="",c=s[e.type_code]?s[e.type_code][0]:s[s.length-1][0]?s[s.length-1][0]:"unknown";switch(l+=t?"[PK] "+c:c,e.precision&&e.precision>=0&&65535!=e.precision&&(l+=" ("+e.precision,l+=e.scale&&65535!=e.scale?","+e.scale+")":")"),c){case"oid":n="oid";break;case"json":case"json[]":case"jsonb":case"jsonb[]":n="Json";break;case"smallint":case"smallint[]":case"integer":case"integer[]":case"bigint":case"bigint[]":case"decimal":case"decimal[]":case"numeric":case"numeric[]":case"real":case"real[]":case"double precision":case"double precision[]":n="number";break;case"boolean":n="boolean";break;case"character":case"character[]":case'"char"':case'"char"[]':case"character varying":case"character varying[]":e.internal_size&&e.internal_size>=0&&65535!=e.internal_size&&(l+=" ("+e.internal_size+")"),n="string";break;case"bytea":case"bytea[]":n="binary";break;default:n="string"}d=e.display_name+"<br>"+l;var u=c.lastIndexOf("[]"),p={name:e.name,display_name:e.display_name,column_type:l,column_type_internal:c,pos:e.pos,label:d,cell:n,can_edit:"oid"!=e.name&&a.can_edit,type:c,not_null:e.not_null,has_default_val:e.has_default_val,is_array:u>-1&&u+2==c.length};o.push(p)}),a.columns=o,t&&"function"==typeof t&&t()},resetQueryHistoryObject:function(e){e.total_time="-"},update_msg_history:function(e,t,n){var o=this;void 0===n&&(n=!0),o.gridView.messages_panel.focus(),n?(o.gridView.handler.slickgrid&&o.gridView.handler.slickgrid.destroy(),o.columns=void 0,o.collection=void 0,r(".sql-editor-message").text(t)):r(".sql-editor-message").append(i.escape(t)),setTimeout(function(){r(".sql-editor-message").scrollTop(r(".sql-editor-message")[0].scrollHeight)},10),"Busy"!=e&&(r("#btn-flash").prop("disabled",!1),o.trigger("pgadmin-sqleditor:loading-icon:hide"),o.gridView.history_collection.add({status:e,start_time:o.query_start_time,query:o.query,row_affected:o.rows_affected,total_time:o.total_time,message:t}))},get_query_run_time:function(e,t){var n,r;n=r=t.getTime()-e.getTime(),n/=1e3;var i=Math.floor(n%60);n/=60;var o=Math.floor(n%60);return o>0?o+" min":i>0?i+" secs":r+" msec"},is_editable:function(e){var t=this;return!(e instanceof d.Collection)&&t.get("can_edit")},rows_to_delete:function(e){var t=this,n=t.primary_keys;t.temp_new_rows=[],e.forEach(function(e,r){var o=i.pick(e,n);(Object.keys(o).length?o[0]:void 0)||t.temp_new_rows.push(r)}),t.rows_to_disable=i.clone(t.temp_new_rows)},_delete:function(){var e=this,n=[],o=(document.getElementById("datagrid"),i.size(e.data_store.added)),a=i.size(e.data_store.updated);if(o&&i.each(e.data_store.added,function(t,r){r in e.data_store.staged_rows&&(n.push(r),delete e.data_store.staged_rows[r],delete e.data_store.added[r],delete e.data_store.added_index[r])}),0==i.size(e.data_store.staged_rows)){var l=e.slickgrid,d=l.getData();d.getItems();l.resetActiveCell(),d.beginUpdate();for(var c=0;c<n.length;c++)d.deleteItem(n[c]);d.endUpdate(),e.rows_to_delete.apply(e,[d.getItems()]),l.resetActiveCell(),l.setSelectedRows([]),l.invalidate(),r("#btn-delete-row").prop("disabled",!0),r("#btn-copy-row").prop("disabled",!0),i.size(e.data_store.added)||a?r("#btn-save").prop("disabled",!1):r("#btn-save").prop("disabled",!0),s.success(t("Row(s) deleted."))}else{if(a)return void s.alert(t("Operation failed"),t("There are unsaved changes in the grid. Please save them first to avoid data inconsistencies."));s.confirm(t("Delete Row(s)"),t("Are you sure you wish to delete selected row(s)?"),function(){r("#btn-delete-row").prop("disabled",!0),r("#btn-copy-row").prop("disabled",!0),e.data_store.deleted=e.data_store.staged_rows,e.data_store.staged_rows={},e._save()},function(){}).set("labels",{ok:t("Yes"),cancel:t("No")})}},_save:function(e,o,d){var c=this;if(c.is_query_tool){var u=c.gridView.current_file;if(i.isUndefined(u)||d){var p={supported_types:["*","sql"],dialog_type:"create_file",dialog_title:"Save File",btn_primary:"Save"};l.FileManager.init(),l.FileManager.show_dialog(p)}else c._save_file_handler(u)}else{r("#btn-save").prop("disabled",!0),r("#btn-file-menu-dropdown").prop("disabled",!0);var f=i.size(c.data_store.added),_=i.size(c.data_store.updated),g=i.size(c.data_store.deleted);if(f||_||g){c.trigger("pgadmin-sqleditor:loading-icon:show",t("Saving the updated data..."));var h=c.data_store;h.columns=e?e.handler.columns:c.columns,r.ajax({url:n("sqleditor.save",{trans_id:c.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(h),success:function(e){var n=c.slickgrid,o=n.getData(),l=o.getLength(),d=[];if(e.data.status){if(f&&(o.beginUpdate(),i.each(e.data.query_result,function(e){if(!i.isNull(e.row_added)){var t=Object.keys(e.row_added)[0];i.each(h.added_index,function(r,o){if(r==t){var a=n.getDataItem(o);i.extend(a,e.row_added[t])}})}}),o.endUpdate()),i.each(d,function(e,t){e.is_row_copied&&delete e.is_row_copied}),n.copied_rows&&delete n.copied_rows,g){var u=n.getSelectedRows();if(l==u.length)d=[],o.setItems(d,c.client_primary_key);else{o.beginUpdate();for(var p=0;p<u.length;p++){var _=n.getDataItem(u[p]);d.push(_),o.deleteItem(_[c.client_primary_key])}o.endUpdate()}c.rows_to_delete.apply(c,[d]),n.setSelectedRows([])}n.setSelectedRows([]),c.data_store={added:{},updated:{},deleted:{},added_index:{},updated_index:{}},c.primary_keys_data={},r(".sql-editor-message").html(""),s.success(t("Data saved successfully."))}else{r("#btn-flash").prop("disabled",!1),r(".sql-editor-message").text(e.data.result);var m=a(t("%s.")).sprintf(e.data.result).value();if(s.error(m,20),n.setSelectedRows([]),i.has(e.data,"_rowid")&&(!i.isUndefined(e.data._rowid)||!i.isNull(e.data._rowid))){var y=c._find_rowindex(e.data._rowid);if(y in c.data_store.added_index){var v=c.handler.temp_new_rows.indexOf(e.data._rowid);v>-1&&c.handler.temp_new_rows.splice(v,1),c.data_store.added[c.data_store.added_index[y]].err=!0}else y in c.data_store.updated_index&&(c.data_store.updated[c.data_store.updated_index[y]].err=!0)}n.gotoCell(y,1)}i.each(e.data.query_result,function(e){c.gridView.history_collection.add({status:e.status,start_time:c.query_start_time,query:e.sql,row_affected:e.rows_affected,total_time:c.total_time,message:e.result})}),c.trigger("pgadmin-sqleditor:loading-icon:hide"),n.invalidate(),c.close_on_save&&c.close()},error:function(e){if(0==e.readyState)return void c.update_msg_history(!1,t("Not connected to the server or the connection to the server has been closed."));var n=e.responseText;void 0!=e.responseJSON&&void 0!=e.responseJSON.errormsg&&(n=e.responseJSON.errormsg),c.update_msg_history(!1,n)}})}}},_find_rowindex:function(e){var t,n=this,r=n.slickgrid,o=r.getData(),a=o.getItems(),s=0,l=-1;if(i.isObject(e))t=e;else{if(!i.isString(e))return l;var e={};e[n.client_primary_key]=e,t=e}return i.find(a,function(e){var n=[];if(n.push(e),i.findWhere(n,t))return l=s,!0;s++}),l},_save_as:function(){return this._save(!0)},setTitle:function(e){this.is_new_browser_tab?window.document.title=e:i.each(window.top.pgAdmin.Browser.docker.findPanels("frm_datagrid"),function(t){t.isVisible()&&t.title(decodeURIComponent(e))})},_load_file:function(){var e=this;e.is_query_changed?s.confirm(t("Unsaved changes"),t("Are you sure you wish to discard the current changes?"),function(){e._open_select_file_manager()},function(){return!0}).set("labels",{ok:"Yes",cancel:"No"}):e._open_select_file_manager()},_open_select_file_manager:function(){var e={supported_types:["sql"],dialog_type:"select_file"};l.FileManager.init(),l.FileManager.show_dialog(e)},_select_file_handler:function(e){var i=this,o={file_name:decodeURI(e)};i.trigger("pgadmin-sqleditor:loading-icon:show",t("Loading the file..."));var a=r(".sql-editor-busy-fetching");a.addClass("show_progress"),r.ajax({url:n("sqleditor.load_file"),method:"POST",contentType:"application/json",data:JSON.stringify(o),success:function(t){i.gridView.query_tool_obj.setValue(t),i.gridView.current_file=e,i.setTitle(i.gridView.current_file.split("\\").pop().split("/").pop()),i.trigger("pgadmin-sqleditor:loading-icon:hide"),a.removeClass("show_progress"),r("#btn-save").prop("disabled",!0),r("#btn-file-menu-save").css("display","none"),i.is_query_changed=!1},error:function(e){var t=r.parseJSON(e.responseText).errormsg;s.error(t),i.trigger("pgadmin-sqleditor:loading-icon:hide"),a.removeClass("show_progress")}})},_save_file_handler:function(e){var i=this,o={file_name:decodeURI(e),file_content:i.gridView.query_tool_obj.getValue()};i.trigger("pgadmin-sqleditor:loading-icon:show",t("Saving the queries in the file...")),r.ajax({url:n("sqleditor.save_file"),method:"POST",contentType:"application/json",data:JSON.stringify(o),success:function(n){n.data.status&&(s.success(t("File saved successfully.")),i.gridView.current_file=e,i.setTitle(i.gridView.current_file.replace(/^.*[\\\/]/g,"")),r("#btn-save").prop("disabled",!0),r("#btn-file-menu-save").css("display","none"),i.is_query_changed=!1),i.trigger("pgadmin-sqleditor:loading-icon:hide"),i.close_on_save&&i.close()},error:function(e){i.trigger("pgadmin-sqleditor:loading-icon:hide");var t=r.parseJSON(e.responseText).errormsg;setTimeout(function(){s.error(t)},10)}})},_on_query_change:function(e){var t=this;if(!t.is_query_changed){if(t.is_query_changed=!0,t.gridView.current_file){var n=t.gridView.current_file.replace(/^.*[\\\/]/g,"")+" *";t.setTitle(n)}else{var n="";t.is_new_browser_tab?n=window.document.title+" *":(i.each(window.top.pgAdmin.Browser.docker.findPanels("frm_datagrid"),function(e){e.isVisible()&&(t.gridView.panel_title=e._title)}),n=t.gridView.panel_title+" *"),t.setTitle(n)}r("#btn-save").prop("disabled",!1),r("#btn-file-menu-save").css("display","block"),r("#btn-file-menu-dropdown").prop("disabled",!1)}},_init_polling_flags:function(){var e=this;e.POLL_FALLBACK_TIME=function(){var t=parseInt((Date.now()-e.query_start_time.getTime())/1e3);return t>=10&&t<30?500:t>=30&&t<60?1e3:t>=60&&t<90?2e3:t>=90?5e3:1}},_show_filter:function(){var e=this;e.trigger("pgadmin-sqleditor:loading-icon:show",t("Loading the existing filter options...")),r.ajax({url:n("sqleditor.get_filter",{trans_id:e.transId}),method:"GET",success:function(n){e.trigger("pgadmin-sqleditor:loading-icon:hide"),n.data.status?(r("#filter").removeClass("hidden"),r("#editor-panel").addClass("sql-editor-busy-fetching"),e.gridView.filter_obj.refresh(),null==n.data.result?e.gridView.filter_obj.setValue(""):e.gridView.filter_obj.setValue(n.data.result),e.gridView.filter_obj.focus()):setTimeout(function(){s.alert(t("Get Filter Error"),n.data.result)},10)},error:function(n){e.trigger("pgadmin-sqleditor:loading-icon:hide");var r;0==n.readyState?r=t("Not connected to the server or the connection to the server has been closed."):(r=n.responseText,void 0!=n.responseJSON&&void 0!=n.responseJSON.errormsg&&(r=n.responseJSON.errormsg)),setTimeout(function(){s.alert(t("Get Filter Error"),r)},10)}})},_include_filter:function(){var e,o,a,l,d=this,c={};e=d.slickgrid,o=e.getActiveCell(),i.isNull(o)||i.isUndefined(o)||(a=e.getColumns()[o.cell],l=e.getDataItem(o.row,o.cell),i.isNull(l)||i.isUndefined(l)||(c[a.field]=l[a.field]||"",d.trigger("pgadmin-sqleditor:loading-icon:show",t("Applying the new filter...")),r.ajax({url:n("sqleditor.inclusive_filter",{trans_id:d.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(c),success:function(e){d.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout(function(){e.data.status?E.executeQuery(d):s.alert(t("Filter By Selection Error"),e.data.result)})},error:function(e){d.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout(function(){if(0==e.readyState)return void s.alert(t("Filter By Selection Error"),t("Not connected to the server or the connection to the server has been closed."));var n=e.responseText;void 0!=e.responseJSON&&void 0!=e.responseJSON.errormsg&&(n=e.responseJSON.errormsg),s.alert(t("Filter By Selection Error"),n)},10)}})))},_exclude_filter:function(){var e,o,a,l,d=this,c={};e=d.slickgrid,o=e.getActiveCell(),i.isNull(o)||i.isUndefined(o)||(a=e.getColumns()[o.cell],l=e.getDataItem(o.row,o.cell),i.isNull(l)||i.isUndefined(l)||(c[a.field]=l[a.field]||"",d.trigger("pgadmin-sqleditor:loading-icon:show",t("Applying the new filter...")),r.ajax({url:n("sqleditor.exclusive_filter",{trans_id:d.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(c),success:function(e){d.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout(function(){e.data.status?E.executeQuery(d):s.alert(t("Filter Exclude Selection Error"),e.data.result)},10)},error:function(e){d.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout(function(){if(0==e.readyState)return void s.alert(t("Filter Exclude Selection Error"),t("Not connected to the server or the connection to the server has been closed."));var n=e.responseText;void 0!=e.responseJSON&&void 0!=e.responseJSON.errormsg&&(n=e.responseJSON.errormsg),s.alert(t("Filter Exclude Selection Error"),n)},10)}})))},_remove_filter:function(){var e=this;e.trigger("pgadmin-sqleditor:loading-icon:show",t("Removing the filter...")),r.ajax({url:n("sqleditor.remove_filter",{trans_id:e.transId}),method:"POST",success:function(n){e.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout(function(){n.data.status?E.executeQuery(e):s.alert(t("Remove Filter Error"),n.data.result)})},error:function(n){e.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout(function(){if(0==n.readyState)return void s.alert(t("Remove Filter Error"),t("Not connected to the server or the connection to the server has been closed."));var e=n.responseText;void 0!=n.responseJSON&&void 0!=n.responseJSON.errormsg&&(e=n.responseJSON.errormsg),s.alert(t("Remove Filter Error"),e)})}})},_apply_filter:function(){var e=this,i=e.gridView.filter_obj.getValue();e.trigger("pgadmin-sqleditor:loading-icon:show",t("Applying the filter...")),r.ajax({url:n("sqleditor.apply_filter",{trans_id:e.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(n){e.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout(function(){n.data.status?(r("#filter").addClass("hidden"),r("#editor-panel").removeClass("sql-editor-busy-fetching"),E.executeQuery(e)):s.alert(t("Apply Filter Error"),n.data.result)},10)},error:function(n){e.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout(function(){if(0==n.readyState)return void s.alert(t("Apply Filter Error"),t("Not connected to the server or the connection to the server has been closed."));var e=n.responseText;void 0!=n.responseJSON&&void 0!=n.responseJSON.errormsg&&(e=n.responseJSON.errormsg),s.alert(t("Apply Filter Error"),e)},10)}})},_copy_row:g,_paste_row:function(){var e=this,t=e.slickgrid,n=t.getData(),a=n.getItems(),s=n.getLength(),l=t.getSelectedRows().sort(function(e,t){return e-t}),d=l.map(function(e){return a[e]}),c=[];for(var u in e.columns)e.columns[u].is_array&&c.push(e.columns[u].name);if(l=0==l.length?e.last_copied_rows:l,e.last_copied_rows=l,d.length>0){r("#btn-save").prop("disabled",!1);var p=function(e){var t={};"object"==(void 0===e?"undefined":o(e))?Object.keys(e).length:e.length;return i.each(e,function(n,r){void 0!==e[r]&&(i.isObject(e[r])&&-1==c.indexOf(r)?t[String(r)]=JSON.stringify(e[r]):t[String(r)]=e[r])}),t};n.beginUpdate(),i.each(d,function(t){var r=p(t),i=(e.gridView.client_primary_key_counter++).toString();r.is_row_copied=!0,e.temp_new_rows.push(s),r[e.client_primary_key]=i,n.addItem(r),e.data_store.added[i]={err:!1,data:r},e.data_store.added_index[s]=i,s++}),n.endUpdate(),t.updateRowCount(),t.scrollRowIntoView(n.getLength()),t.setSelectedRows([])}},_set_limit:function(){var e=this,i=parseInt(r(".limit").val());e.trigger("pgadmin-sqleditor:loading-icon:show",t("Setting the limit on the result...")),r.ajax({url:n("sqleditor.set_limit",{trans_id:e.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(n){e.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout(function(){n.data.status?E.executeQuery(e):s.alert(t("Change limit Error"),n.data.result)},10)},error:function(n){e.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout(function(){if(0==n.readyState)return void s.alert(t("Change limit Error"),t("Not connected to the server or the connection to the server has been closed."));var e=n.responseText;void 0!=n.responseJSON&&void 0!=n.responseJSON.errormsg&&(e=n.responseJSON.errormsg),s.alert(t("Change limit Error"),e)},10)}})},disable_tool_buttons:function(e){r("#btn-clear").prop("disabled",e),r("#btn-query-dropdown").prop("disabled",e),r("#btn-edit-dropdown").prop("disabled",e),r("#btn-edit").prop("disabled",e),r("#btn-load-file").prop("disabled",e)},execute:function(e){var i=this,o="";i.has_more_rows=!1,i.fetching_rows=!1;var s=i.gridView.query_tool_obj.getSelection();o=s.length>0?s:i.gridView.query_tool_obj.getValue(),o.length<=0||(i.trigger("pgadmin-sqleditor:loading-icon:show",t("Initializing query execution...")),r("#btn-flash").prop("disabled",!0),void 0==e||a.startsWith(o.trim().toUpperCase(),"EXPLAIN")||(o=e+" "+o),i.query_start_time=new Date,i.query=o,i.rows_affected=0,i._init_polling_flags(),i.disable_tool_buttons(!0),r("#btn-cancel-query").prop("disabled",!1),r.ajax({url:n("sqleditor.query_tool_start",{trans_id:i.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(o),success:function(e){i.gridView.marker&&(i.gridView.marker.clear(),delete i.gridView.marker,i.gridView.marker=null,i.gridView.query_tool_obj.removeLineClass(i.marked_line_no,"wrap","CodeMirror-activeline-background")),e.data.status?(i.trigger("pgadmin-sqleditor:loading-icon:message",t("Waiting for the query execution to complete...")),i.can_edit=e.data.can_edit,i.can_filter=e.data.can_filter,i.info_notifier_timeout=e.data.info_notifier_timeout,i._poll()):(i.trigger("pgadmin-sqleditor:loading-icon:hide"),i.disable_tool_buttons(!1),r("#btn-cancel-query").prop("disabled",!0),i.update_msg_history(!1,e.data.result),i._highlight_error(e.data.result))},error:function(e){if(i.trigger("pgadmin-sqleditor:loading-icon:hide"),i.disable_tool_buttons(!1),r("#btn-cancel-query").prop("disabled",!0),0==e.readyState)return void i.update_msg_history(!1,t("Not connected to the server or the connection to the server has been closed."));var n=e.responseText;void 0!=e.responseJSON&&void 0!=e.responseJSON.errormsg&&(n=e.responseJSON.errormsg),i.update_msg_history(!1,n)}}))},_highlight_error:function(e){var t=this,n=0,r=0,i=0,o=0;t.gridView.query_tool_obj.removeLineClass(t.marked_line_no,"wrap","CodeMirror-activeline-background"),t.gridView.query_tool_obj.getSelection().length>0&&(o=t.gridView.query_tool_obj.getCursor(!0).line);var a=/LINE (\d+)/.exec(e),s=/Character: (\d+)/.exec(e);if(null!=a&&null!=s){n=t.marked_line_no=parseInt(a[1])-1+o;for(var l=parseInt(s[1])-1,d=0,c=o>0?o:0,u=c;u<n;u++)d+=t.gridView.query_tool_obj.getLine(u).length+1;r=l-d;var p=t.gridView.query_tool_obj.getLine(n);i=p.indexOf(" ",r),i<0&&(i=p.length),t.gridView.marker=t.gridView.query_tool_obj.markText({line:n,ch:r},{line:n,ch:i},{className:"sql-editor-mark"}),t.gridView.query_tool_obj.addLineClass(t.marked_line_no,"wrap","CodeMirror-activeline-background")}},_cancel_query:function(){var e=this;r("#btn-cancel-query").prop("disabled",!0),r.ajax({url:n("sqleditor.cancel_transaction",{trans_id:e.transId}),method:"POST",contentType:"application/json",success:function(n){n.data.status?e.disable_tool_buttons(!1):(e.disable_tool_buttons(!1),s.alert(t("Cancel Query Error"),n.data.result))},error:function(n){if(e.disable_tool_buttons(!1),0==n.readyState)return void s.alert(t("Cancel Query Error"),t("Not connected to the server or the connection to the server has been closed."));var r=n.responseText;void 0!=n.responseJSON&&void 0!=n.responseJSON.errormsg&&(r=n.responseJSON.errormsg),s.alert(t("Cancel Query Error"),r)}})},trigger_csv_download:function(e,t){var i=this,o=r(this.container).find("#download-csv"),a=n("sqleditor.query_tool_download",{trans_id:i.transId});a+="?"+r.param({query:e,filename:t}),o.attr("src",a)},_auto_rollback:function(){var e=this,i=!0;!0===r(".auto-rollback").hasClass("visibility-hidden")?r(".auto-rollback").removeClass("visibility-hidden"):(r(".auto-rollback").addClass("visibility-hidden"),i=!1),r.ajax({url:n("sqleditor.auto_rollback",{trans_id:e.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(e){e.data.status||s.alert(t("Auto Rollback Error"),e.data.result)},error:function(e){if(0==e.readyState)return void s.alert(t("Auto Rollback Error"),t("Not connected to the server or the connection to the server has been closed."));var n=e.responseText;void 0!=e.responseJSON&&void 0!=e.responseJSON.errormsg&&(n=e.responseJSON.errormsg),s.alert(t("Auto Rollback Error"),n)}})},_auto_commit:function(){var e=this,i=!0;!0===r(".auto-commit").hasClass("visibility-hidden")?r(".auto-commit").removeClass("visibility-hidden"):(r(".auto-commit").addClass("visibility-hidden"),i=!1),r.ajax({url:n("sqleditor.auto_commit",{trans_id:e.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(e){e.data.status||s.alert(t("Auto Commit Error"),e.data.result)},error:function(e){if(0==e.readyState)return void s.alert(t("Auto Commit Error"),t("Not connected to the server or the connection to the server has been closed."));var n=e.responseText;void 0!=e.responseJSON&&void 0!=e.responseJSON.errormsg&&(n=e.responseJSON.errormsg),s.alert(t("Auto Commit Error"),n)}})},_explain_verbose:function(){var e=this;!0===r(".explain-verbose").hasClass("visibility-hidden")?(r(".explain-verbose").removeClass("visibility-hidden"),e.explain_verbose=!0):(r(".explain-verbose").addClass("visibility-hidden"),e.explain_verbose=!1);var i={explain_verbose:e.explain_verbose};r.ajax({url:n("sqleditor.query_tool_preferences",{trans_id:e.transId}),method:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(e){void 0!=e.success&&e.success||s.alert(t("Explain options error"),t("Error occurred while setting verbose option in explain."))},error:function(e){s.alert(t("Explain options error"),t("Error occurred while setting verbose option in explain."))}})},_explain_costs:function(){var e=this;!0===r(".explain-costs").hasClass("visibility-hidden")?(r(".explain-costs").removeClass("visibility-hidden"),e.explain_costs=!0):(r(".explain-costs").addClass("visibility-hidden"),e.explain_costs=!1);var i={explain_costs:e.explain_costs};r.ajax({url:n("sqleditor.query_tool_preferences",{trans_id:e.transId}),method:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(e){void 0!=e.success&&e.success||s.alert(t("Explain options error"),t("Error occurred while setting costs option in explain."))},error:function(e){s.alert(t("Explain options error"),t("Error occurred while setting costs option in explain."))}})},_explain_buffers:function(){var e=this;!0===r(".explain-buffers").hasClass("visibility-hidden")?(r(".explain-buffers").removeClass("visibility-hidden"),e.explain_buffers=!0):(r(".explain-buffers").addClass("visibility-hidden"),e.explain_buffers=!1);var i={explain_buffers:e.explain_buffers};r.ajax({url:n("sqleditor.query_tool_preferences",{trans_id:e.transId}),method:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(e){void 0!=e.success&&e.success||s.alert(t("Explain options error"),t("Error occurred while setting buffers option in explain."))},error:function(e){s.alert(t("Explain options error"),t("Error occurred while setting buffers option in explain."))}})},_explain_timing:function(){var e=this;!0===r(".explain-timing").hasClass("visibility-hidden")?(r(".explain-timing").removeClass("visibility-hidden"),e.explain_timing=!0):(r(".explain-timing").addClass("visibility-hidden"),e.explain_timing=!1);var i={explain_timing:e.explain_timing};r.ajax({url:n("sqleditor.query_tool_preferences",{trans_id:e.transId}),method:"PUT",contentType:"application/json",data:JSON.stringify(i),success:function(e){void 0!=e.success&&e.success||s.alert(t("Explain options error"),t("Error occurred while setting timing option in explain."))},error:function(e){s.alert(t("Explain options error"),t("Error occurred while setting timing option in explain."))}})},_indent_selected_code:function(){this.gridView.query_tool_obj.execCommand("indentMore")},_unindent_selected_code:function(){this.gridView.query_tool_obj.execCommand("indentLess")},isQueryRunning:function(){return P},get_preferences:function(){var e=this,i=!1,o=!1,a=!1,l=!1,d=!0,c=!1,u=function(){d&&!0===r(".auto-commit").hasClass("visibility-hidden")?r(".auto-commit").removeClass("visibility-hidden"):r(".auto-commit").addClass("visibility-hidden"),c&&!0===r(".auto-rollback").hasClass("visibility-hidden")?r(".auto-rollback").removeClass("visibility-hidden"):r(".auto-rollback").addClass("visibility-hidden"),i&&!0===r(".explain-verbose").hasClass("visibility-hidden")?r(".explain-verbose").removeClass("visibility-hidden"):r(".explain-verbose").addClass("visibility-hidden"),o&&!0===r(".explain-costs").hasClass("visibility-hidden")?r(".explain-costs").removeClass("visibility-hidden"):r(".explain-costs").addClass("visibility-hidden"),a&&!0===r(".explain-buffers").hasClass("visibility-hidden")?r(".explain-buffers").removeClass("visibility-hidden"):r(".explain-buffers").addClass("visibility-hidden"),l&&!0===r(".explain-timing").hasClass("visibility-hidden")?r(".explain-timing").removeClass("visibility-hidden"):r(".explain-timing").addClass("visibility-hidden")};r.ajax({url:n("sqleditor.query_tool_preferences",{trans_id:e.transId}),method:"GET",success:function(e){e.data&&(i=e.data.explain_verbose,o=e.data.explain_costs,a=e.data.explain_buffers,l=e.data.explain_timing,d=e.data.auto_commit,c=e.data.auto_rollback,u())},error:function(e){u(),s.alert(t("Get Preferences error"),t("Error occurred while getting query tool options."))}})},close:function(){var e=this;i.each(window.top.pgAdmin.Browser.docker.findPanels("frm_datagrid"),function(t){t.isVisible()&&(window.onbeforeunload=null,t.off(q.EVENT.CLOSING),i.isUndefined(e.col_size)||delete e.col_size,window.top.pgAdmin.Browser.docker.removePanel(t))})}}),l.SqlEditor={create:function(e){return new j(e)},jquery:r,S:a},l.SqlEditor}.apply(t,r))&&(e.exports=i)},322:function(e,t,n){"use strict";var r,i;r=[n(5),n(0),n(1),n(4),n(3),n(10),n(323)],void 0!==(i=function(e,t,n,r,i,o,a){i=i||window.pgAdmin||{};var s=i.Explain;if(a.plugin(function(e,t,n,r){n.prototype.multitext=function(t,n,r,i,o){var a=e(),s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",l=a.text(0,0,s);l.attr(o);var d=l.getBBox().width/s.length,c=Math.round(i/d)-1;a.remove();for(var u=r.split(" "),p=0,f=[],_="",g=0;g<u.length;g++){var h=function e(t,n,r){var o=r.length,a=[];return 0==o?a:(n&&n+o*d>i?(a.push(t),a=a.concat(e("",0,r))):n?a.push(t+" "+r):(t&&a.push(t),r.length>c+1?a.push(r.slice(0,c)+"-"):a.push(r),a=a.concat(e("",0,r.slice(c)))),a)}(_,p,u[g]);_&&(f=f.slice(0,f.length-1)),f=f.concat(h),_=f[f.length-1],p=_.length*d}var m=this.text(t,n,f).attr(o);return m.selectAll("tspan:nth-child(n+2)").attr({dy:"1.2em",x:t}),m}}),i.Explain)return i.Explain;var s=i.Explain={prefix:e("misc.index")+"static/explain/img/"},l={Aggregate:{image:"ex_aggregate.svg",image_text:"Aggregate"},Append:{image:"ex_append.svg",image_text:"Append"},"Bitmap Index Scan":function(e){return{image:"ex_bmp_index.svg",image_text:e["Index Name"]}},"Bitmap Heap Scan":function(e){return{image:"ex_bmp_heap.svg",image_text:e["Relation Name"]}},BitmapAnd:{image:"ex_bmp_and.svg",image_text:"Bitmap AND"},BitmapOr:{image:"ex_bmp_or.svg",image_text:"Bitmap OR"},"CTE Scan":{image:"ex_cte_scan.svg",image_text:"CTE Scan"},"Function Scan":{image:"ex_result.svg",image_text:"Function Scan"},"Foreign Scan":{image:"ex_foreign_scan.svg",image_text:"Foreign Scan"},Gather:{image:"ex_gather_motion.svg",image_text:"Gather"},Group:{image:"ex_group.svg",image_text:"Group"},GroupAggregate:{image:"ex_aggregate.svg",image_text:"Group Aggregate"},Hash:{image:"ex_hash.svg",image_text:"Hash"},"Hash Join":function(e){if(!e["Join Type"])return{image:"ex_join.svg",image_text:"Join"};switch(e["Join Type"]){case"Anti":return{image:"ex_hash_anti_join.svg",image_text:"Hash Anti Join"};case"Semi":return{image:"ex_hash_semi_join.svg",image_text:"Hash Semi Join"};default:return{image:"ex_hash.svg",image_text:String("Hash "+e["Join Type"]+" Join")}}},HashAggregate:{image:"ex_aggregate.svg",image_text:"Hash Aggregate"},"Index Only Scan":function(e){return{image:"ex_index_only_scan.svg",image_text:e["Index Name"]}},"Index Scan":function(e){return{image:"ex_index_scan.svg",image_text:e["Index Name"]}},"Index Scan Backword":{image:"ex_index_scan.svg",image_text:"Index Backward Scan"},Limit:{image:"ex_limit.svg",image_text:"Limit"},LockRows:{image:"ex_lock_rows.svg",image_text:"Lock Rows"},Materialize:{image:"ex_materialize.svg",image_text:"Materialize"},"Merge Append":{image:"ex_merge_append.svg",image_text:"Merge Append"},"Merge Join":function(e){switch(e["Join Type"]){case"Anti":return{image:"ex_merge_anti_join.svg",image_text:"Merge Anti Join"};case"Semi":return{image:"ex_merge_semi_join.svg",image_text:"Merge Semi Join"};default:return{image:"ex_merge.svg",image_text:String("Merge "+e["Join Type"]+" Join")}}},ModifyTable:function(e){switch(e.Operation){case"Insert":return{image:"ex_insert.svg",image_text:"Insert"};case"Update":return{image:"ex_update.svg",image_text:"Update"};case"Delete":return{image:"ex_delete.svg",image_text:"Delete"}}},"Nested Loop":function(e){switch(e["Join Type"]){case"Anti":return{image:"ex_nested_loop_anti_join.svg",image_text:"Nested Loop Anti Join"};case"Semi":return{image:"ex_nested_loop_semi_join.svg",image_text:"Nested Loop Semi Join"};default:return{image:"ex_nested.svg",image_text:"Nested Loop "+e["Join Type"]+" Join"}}},"Recursive Union":{image:"ex_recursive_union.svg",image_text:"Recursive Union"},Result:{image:"ex_result.svg",image_text:"Result"},"Sample Scan":{image:"ex_scan.svg",image_text:"Sample Scan"},Scan:{image:"ex_scan.svg",image_text:"Scan"},Seek:{image:"ex_seek.svg",image_text:"Seek"},SetOp:function(e){var t=e.Strategy,n=e.Command;return"Hashed"==t?r.startsWith(n,"Intersect")?"Intersect All"==n?{image:"ex_hash_setop_intersect_all.svg",image_text:"Hashed Intersect All"}:{image:"ex_hash_setop_intersect.svg",image_text:"Hashed Intersect"}:r.startsWith(n,"Except")?"Except All"==n?{image:"ex_hash_setop_except_all.svg",image_text:"Hashed Except All"}:{image:"ex_hash_setop_except.svg",image_text:"Hash Except"}:{image:"ex_hash_setop_unknown.svg",image_text:"Hashed SetOp Unknown"}:{image:"ex_setop.svg",image_text:"SetOp"}},"Seq Scan":function(e){return{image:"ex_scan.svg",image_text:e["Relation Name"]}},"Subquery Scan":{image:"ex_subplan.svg",image_text:"SubQuery Scan"},Sort:{image:"ex_sort.svg",image_text:"Sort"},"Tid Scan":{image:"ex_tid_scan.svg",image_text:"Tid Scan"},Unique:{image:"ex_unique.svg",image_text:"Unique"},"Values Scan":{image:"ex_values_scan.svg",image_text:"Values Scan"},WindowAgg:{image:"ex_window_aggregate.svg",image_text:"Window Aggregate"},"WorkTable Scan":{image:"ex_worktable_scan.svg",image_text:"WorkTable Scan"},Undefined:{image:"ex_unknown.svg",image_text:"Undefined"}},d=void 0,c=void 0,u=o.Model.extend({defaults:{Plans:[],level:[],image:void 0,image_text:void 0,xpos:void 0,ypos:void 0,width:100,height:100},parse:function(e){var t=1,i=e.level=e.level||[t],o=[],a=e["Node Type"],s=e.xpos=e.xpos-100,d=e.ypos,c=0;e.width=100,e.height=100,"SubPlan"===e["Parent Relationship"]&&(e.width+=62.5,e.height+=50,e.ypos+=25,s-=25,d+=25),r.startsWith(a,"(slice")&&(a=a.substring(0,7));var p=n.isFunction(l[a])&&l[a].apply(void 0,[e])||l[a]||{image:"ex_unknown.svg",image_text:a};return e.image=p.image,e.image_text=p.image_text,"Plans"in e&&(e.width+=200,n.each(e.Plans,function(r){var a=n.clone(i),l=new u;a.push(t),l.set(l.parse(n.extend(r,{level:a,xpos:s-200,ypos:d}))),c<l.get("width")&&(c=l.get("width"));var p=l.get("height");1!==t?e.height=e.height+p+60:p>e.height&&(e.height=p),d+=p+60,o.push(l),t++})),e.width+=c,e.Plans=o,e},toJSON:function(e){var t=o.Model.prototype.toJSON.apply(this,arguments);if(e)delete t.Plans;else{var r=[];n.each(t.Plans,function(e){r.push(e.toJSON())}),t.Plans=r}return t},drawPolyLine:function(e,t,n,r,i,o,a){var s=t+(r-t)/3,l=t+(r-t)/3*2,d=e.polygon([0,10,5,10,2.5,0,0,10]).transform("r90"),c=d.marker(0,0,10,10,0,5).attr(a);e.line(t,n,s,n).attr(o),e.line(s-1,n,l,i).attr(o),e.line(l,i,r,i).attr(o).attr({markerEnd:c})},draw:function(e,r,i,o,a,l,d){var c=e.g(),u=r+this.get("xpos"),p=i+this.get("ypos"),f="SubPlan"===this.get("Parent Relationship");if(f){c.rect(u-this.get("width")+100+25,p-this.get("height")+100+25-5,this.get("width")-25,this.get("height")+(p-25),5).attr({stroke:"#444444",strokeWidth:1.2,fill:"gray",fillOpacity:.2});c.text(u+100-this.get("width")/2-25,p+100-this.get("height")/2-25,this.get("Subplan Name")).attr({fontSize:"15px","text-anchor":"start",fill:"red"})}var _=c.image(s.prefix+this.get("image"),u+25,p+25,50,50),g=this.toJSON();_.mouseover(function(e){d.empty();var r=t("<table></table>",{class:"pgadmin-tooltip-table"}).appendTo(d);n.each(g,function(e,t){"image"!==t&&"Plans"!==t&&"level"!==t&&"image"!==t&&"image_text"!==t&&"xpos"!==t&&"ypos"!==t&&"width"!==t&&"height"!==t&&r.append('<tr><td class="label explain-tooltip">'+t+'</td><td class="label explain-tooltip-val">'+e+"</td></tr>")});var i=l.data("zoom-factor"),o=(u+100)*i-l.scrollLeft(),a=(p+100)*i-l.scrollTop();l.width()<o+d[0].clientWidth&&(o-=d[0].clientWidth+100*i),l.height()<a+d[0].clientHeight&&(a-=d[0].clientHeight+50*i),o=o<0?0:o,a=a<0?0:a,d.css({opacity:"0.8"}),d.css("left",o),d.css("top",a)}),_.mouseout(function(){d.empty(),d.css({opacity:"0"}),d.css("left",0),d.css("top",0)});var h=void 0==this.get("Schema")?this.get("image_text"):this.get("Schema")+"."+this.get("image_text");c.g();if(c.multitext(u+50+5,p+100-5,h,150,{"font-size":"15px","text-anchor":"middle"}),!n.isUndefined(a)){var m=u+100,y=p+50,v=o-10,b=a+50,w=this.get("Startup Cost"),x=this.get("Total Cost"),C=2;if(void 0!=w&&void 0!=x){var C=Math.round(Math.log((w+x)/2+w));C=C<1?1:C>10?10:C}var S=[0,0,20,20],k={stroke:"#000000",strokeWidth:C+1},E={stroke:"#866486",strokeWidth:C+1},q={viewBox:S.join(" ")};this.drawPolyLine(c,m,y,v,b,f?E:k,q)}var O=this.get("Plans");n.each(O,function(t){t.draw(e,r,i,u,p,l,d)})}}),p=o.Model.extend({defaults:{Plan:void 0,xpos:0,ypos:0},initialize:function(){this.set("Plan",new u)},parse:function(e){if(e&&"Plan"in e){var t=this.get("Plan");t.set(t.parse(n.extend(e.Plan,{xpos:0,ypos:0}))),e.xpos=0,e.ypos=0,e.width=t.get("width")+50,e.height=t.get("height")+100,delete e.Plan}return e},toJSON:function(){var e=o.Model.prototype.toJSON.apply(this,arguments);return e.Plan&&(e.Plan=e.Plan.toJSON()),e},draw:function(e,t,n,r,i){var o=e.g();o.rect(0,0,this.get("width")-10,this.get("height")-10,5).attr({fill:"#FFF"}),d=this.get("width"),c=this.get("height"),this.get("Plan").draw(o,t,n,void 0,void 0,r,i)}});return n.extend(s,{DrawJSONPlan:function(e,r){e.empty();var i=1,o=t("<div></div>",{class:"pg-explain-zoom-area btn-group",role:"group"}).appendTo(e),s=t("<button></button>",{class:"btn pg-explain-zoom-btn badge",title:"Zoom in"}).appendTo(o).append(t("<i></i>",{class:"fa fa-search-plus"})),l=t("<button></button>",{class:"btn pg-explain-zoom-btn badge",title:"Zoom to original"}).appendTo(o).append(t("<i></i>",{class:"fa fa-arrows-alt"})),d=t("<button></button>",{class:"btn pg-explain-zoom-btn badge",title:"Zoom out"}).appendTo(o).append(t("<i></i>",{class:"fa fa-search-minus"})),c=t("<div></div>",{class:"pgadmin-explain-container"}).appendTo(e),u=t("<div></div>",{id:"toolTip",class:"pgadmin-explain-tooltip"}).appendTo(e);u.empty(),c.data("zoom-factor",i);var f=0,_=0,_=25;n.each(r,function(e){var n=new p;n.set(n.parse(e)),f=n.get("width"),_=n.get("height");var r=a(f,_),o=t(r.node).detach();c.append(o),n.draw(r,f-25,25,c,u);var g=c.width();c.height();if(g<f){i=g/f,i=i<.01?.01:i,i=i>1?1:i;var h=new a.matrix;h.scale(i,i),o.find("g").first().attr({transform:h}),o.attr({width:f*i,height:_*i}),c.data("zoom-factor",i)}s.on("click",function(e){i=i+.05>2?2:i+.05;var t=new a.matrix;t.scale(i,i),o.find("g").first().attr({transform:t}),o.attr({width:f*i,height:_*i}),c.data("zoom-factor",i),s.blur()}),d.on("click",function(e){i=i-.05<.01?.01:i-.05;var t=new a.matrix;t.scale(i,i),o.find("g").first().attr({transform:t}),o.attr({width:f*i,height:_*i}),c.data("zoom-factor",i),d.blur()}),l.on("click",function(e){i=1;var t=new a.matrix;t.scale(i,i),o.find("g").first().attr({transform:t}),o.attr({width:f*i,height:_*i}),c.data("zoom-factor",i),l.blur()})})}}),s}.apply(t,r))&&(e.exports=i)},324:function(e,t,n){"use strict";var r,i;r=[n(0),n(2),n(325),n(326),n(31),n(5)],void 0!==(i=function(e,t,n,r,i,o){return function(a){function s(t){i.isEntireGridSelected(t)?e("[data-id='select-all']").addClass("selected"):e("[data-id='select-all']").removeClass("selected")}function l(e,t,n){i.isEntireGridSelected(e)?d(e):(f.notify(n,t),t.isPropagationStopped()||t.isImmediatePropagationStopped()||i.selectAll(e))}function d(e){e.getSelectionModel().setSelectedRanges([])}var c=window.Slick,u=new r(a),p=new n(a),f=new c.Event,_=new c.Event,g=p.onBeforeColumnSelectAll,h=p.onColumnSelectAll,m=function(t){this.grid=t,t.onHeaderClick.subscribe(function(n,r){r.column.selectAllOnClick&&!e(n.target).hasClass("slick-resizable-handle")&&l(t,n,r)}),t.getSelectionModel().onSelectedRangesChanged.subscribe(s.bind(null,t)),t.registerPlugin(u),t.registerPlugin(p),_.subscribe(function(e,t){i.selectAll(t.grid)})},y=function(e){return e=p.getColumnDefinitions(e),e=u.getColumnDefinitions(e),e[0].selectAllOnClick=!0,e[0].name='<span data-id="select-all" title="'+t("Select/Deselect All")+'"><br>'+e[0].name+'<img class="select-all-icon" src="'+o("static",{filename:"img/select-all-icon.png"})+'"></img>',e};e.extend(this,{init:m,getColumnDefinitions:y,onBeforeGridSelectAll:f,onGridSelectAll:_,onBeforeGridColumnSelectAll:g,onGridColumnSelectAll:h})}}.apply(t,r))&&(e.exports=i)},325:function(e,t,n){"use strict";(function(r){var i,o;i=[n(0),n(31),n(77)],void 0!==(o=function(e,t){return function(){var n=window.Slick,i=new n.EventHandler,o=new n.Event,a=new n.Event,s=function(e){i.subscribe(e.onHeaderClick,l.bind(null,e)),e.getSelectionModel().onSelectedRangesChanged.subscribe(d.bind(null,e)),a.subscribe(function(e,t){c(t.grid,t.column.id)})},l=function(t,n,r){var i=r.column;if(t.focus(),p(i)){var a=e(n.target);if(u(n)){if(e(n.target).hasClass("slick-resizable-handle"))return;a=e(n.target).parents(".slick-header-column")}a.toggleClass("selected"),a.hasClass("selected")&&o.notify(r,n),n.isPropagationStopped()||n.isImmediatePropagationStopped()||c(t,i.id)}},d=function(t,n,r){e(".slick-header-column").each(function(n,i){var o=e(i).find('[data-cell-type="column-header-row"]'),a=t.getColumnIndex(o.data("column-id"));f(t,r,a)?e(i).addClass("selected"):e(i).removeClass("selected")})},c=function(e,n){var r,i=e.getSelectionModel(),o=i.getSelectedRanges(),a=e.getColumnIndex(n),s=t.rangeForColumn(e,a);r=t.isRangeSelected(o,s)?t.removeRange(o,s):t.areAllRangesSingleColumns(o,e)?t.addRange(o,s):[s],i.setSelectedRanges(r)},u=function(t){return!e(t.target).hasClass("slick-header-column")},p=function(e){return!1!==e.selectable},f=function(e,n,r){var i=t.areAllRangesCompleteRows(e,n);return _(e,n,r)&&!i},_=function(e,n,r){var i=t.isRangeEntirelyWithinSelectedRanges(n,t.rangeForColumn(e,r)),o=t.isAnyCellOfColumnSelected(n,r);return i||o},g=function(e){return r.map(e,function(e){if(p(e)){var t="<span data-cell-type='column-header-row'        data-test='output-column-header'       data-column-id='"+e.id+"'>  <span class='column-description'>    <span class='column-name'>"+e.display_name+"</span>    <span class='column-type'>"+e.column_type+"</span>  </span></span>";return r.extend(e,{name:t})}return e})};e.extend(this,{init:s,getColumnDefinitions:g,onBeforeColumnSelectAll:o,onColumnSelectAll:a})}}.apply(t,i))&&(e.exports=o)}).call(t,n(1))},326:function(e,t,n){"use strict";var r,i;r=[n(0),n(31),n(77)],void 0!==(i=function(e,t){return function(){var n=window.Slick,r=new n.EventHandler,i=function(e){e.getSelectionModel().onSelectedRangesChanged.subscribe(a.bind(null,e)),r.subscribe(e.onClick,o.bind(null,e))},o=function(t,n,r){if("row-header-column"===t.getColumns()[r.cell].id){var i=e(n.target);"row-header-selector"!=i.data("cell-type")&&(i=e(n.target).find('[data-cell-type="row-header-selector"]')),i.parent().toggleClass("selected"),s(t,r.row)}},a=function(t,n,r){e('[data-cell-type="row-header-selector"]').each(function(n,i){var o=e(i),a=parseInt(o.data("row"));d(t,r,a)?o.parent().addClass("selected"):o.parent().removeClass("selected")})},s=function(e,n){var r,i=e.getSelectionModel(),o=i.getSelectedRanges(),a=t.rangeForRow(e,n);r=t.isRangeSelected(o,a)?t.removeRange(o,a):t.areAllRangesSingleRows(o,e)?t.addRange(o,a):[a],i.setSelectedRanges(r)},l=function(e,n,r){var i=t.isRangeEntirelyWithinSelectedRanges(n,t.rangeForRow(e,r)),o=t.isAnyCellOfRowSelected(n,r);return i||o},d=function(e,n,r){var i=t.areAllRangesCompleteColumns(e,n);return l(e,n,r)&&!i},c=function(e){return e.unshift({id:"row-header-column",name:"",selectable:!1,focusable:!1,formatter:function(e){return'<span data-row="'+e+'" data-cell-type="row-header-selector">'+(e+1)+"</span>"},width:30}),e};e.extend(this,{init:i,getColumnDefinitions:c})}}.apply(t,r))&&(e.exports=i)},327:function(e,t,n){"use strict";var r,i;r=[n(0),n(31)],void 0!==(i=function(e,t){return function(){function n(e,t){O=!0,C.setActiveCell(t.range.start.row,t.range.start.cell)}function r(e,t){if(u())return R=!1,void e.stopPropagation();O=!0;var n=t.column.pos+1;p(0,n)?h()?C.resetActiveCell():C.setActiveCell(0,m().fromCell):f(n)||C.setActiveCell(0,n)}function i(e){return e>=C.getDataLength()}function o(){T=!1}function a(){T=!0,R=!1}function s(){R=!0}function l(e,t){if(_(t.cell)){O=!0;var n=t.row;if(i(n))return;p(n,1)?h()?C.resetActiveCell():C.setActiveCell(m().fromRow,1):g(n)||C.setActiveCell(n,1)}}function d(e){O&&(O=!1,e.stopPropagation())}function c(e){w()&&b(e)&&x()}function u(){return T&&R}function p(e,t){return w()&&C.getActiveCell().row===e&&C.getActiveCell().cell===t}function f(e){var n=t.rangeForColumn(C,e),r=C.getSelectionModel(),i=r.getSelectedRanges();return t.isRangeSelected(i,n)}function _(e){return"row-header-column"===C.getColumns()[e].id}function g(e){var n=t.rangeForRow(C,e),r=C.getSelectionModel(),i=r.getSelectedRanges();return t.isRangeSelected(i,n)}function h(){return 1===C.getSelectionModel().getSelectedRanges().length}function m(){var e=C.getSelectionModel(),t=e.getSelectedRanges();return t[t.length-2]}function y(e){return e.which===S||e.which===E||e.which===k||e.which===q}function v(e){return e.shiftKey&&!e.ctrlKey&&!e.altKey}function b(e){return v(e)&&y(e)}function w(){return!!C.getActiveCell()}function x(){var e=C.getSelectionModel(),t=e.getSelectedRanges();t.length>1&&e.setSelectedRanges([t.pop()])}var C,S=39,k=37,E=38,q=40,O=!1,R=!1,T=!1,P=function(e){C=e,C.onDragEnd.subscribe(n),C.onHeaderClick.subscribe(r),C.onClick.subscribe(l),C.onActiveCellChanged.subscribe(d),C.onKeyDown.subscribe(c),C.onHeaderMouseEnter.subscribe(a),C.onHeaderMouseLeave.subscribe(o),C.onColumnsResized.subscribe(s)},N=function(){C.onDragEnd.unsubscribe(n),C.onHeaderClick.unsubscribe(r),C.onActiveCellChanged.unsubscribe(d),C.onKeyDown.unsubscribe(c),C.onHeaderMouseEnter.unsubscribe(a),C.onHeaderMouseLeave.unsubscribe(o),C.onColumnsResized.unsubscribe(s)};e.extend(this,{init:P,destroy:N})}}.apply(t,r))&&(e.exports=i)},328:function(e,t,n){"use strict";(function(r){var i,o;i=[n(31)],void 0!==(o=function(e){return{getUnion:function(e){function t(e,t){return e[0]-t[0]}function n(e,t){return e[0]<=t[1]+1}function i(e,t){return e[1]<=t[1]}if(r.isEmpty(e))return[];e.sort(t);var o=[e[0]];return e.forEach(function(e){var t=r.last(o);n(e,t)?i(e,t)||(t[1]=e[1]):o.push(e)}),o},mapDimensionBoundaryUnion:function(e,t){var n=[];return e.forEach(function(e){for(var r=e[0];r<=e[1];r+=1)n.push(t(r))}),n},mapOver2DArray:function(e,t,n,r){var i=this.getUnion(e),o=this.getUnion(t);return this.mapDimensionBoundaryUnion(i,function(e){var t=this.mapDimensionBoundaryUnion(o,function(t){return n(e,t)});return r(t)}.bind(this))},rangesToCsv:function(t,n,r,i){var o=r.map(function(e){return[e.fromRow,e.toRow]}),a=r.map(function(e){return[e.fromCell,e.toCell]});return e.isFirstColumnData(n)||(a=this.removeFirstColumn(a)),this.mapOver2DArray(o,a,this.csvCell.bind(this,t,n,i),function(e){var t=i.field_separator||"\t";return e.join(t)}).join("\n")},removeFirstColumn:function(e){var t=this.getUnion(e);if(0==t.length)return[];return function(){return 0==t[0][0]}()&&(!function(){return 0==t[0][1]}()?t[0][0]=1:t.shift()),t},csvCell:function(e,t,n,i,o){var a=e[i][t[o].field],s=n.quoting||"strings",l=n.quote_char||'"';return"all"==s?a&&r.isObject(a)?a=l+JSON.stringify(a)+l:a?a=l+a.toString()+l:(r.isNull(a)||r.isUndefined(a))&&(a=""):"strings"==s&&(a&&r.isObject(a)?a=l+JSON.stringify(a)+l:a&&"number"!=typeof a&&"boolean"!=typeof a?a=l+a.toString()+l:(r.isNull(a)||r.isUndefined(a))&&(a="")),a}}}.apply(t,i))&&(e.exports=o)}).call(t,n(1))},329:function(e,t,n){"use strict";var r,i;r=[n(0),n(1),n(31),n(77)],void 0!==(i=function(e,t,n){return function(r){function i(t){v=e.extend(!0,{},O,r),y=t,y.onActiveCellChanged.subscribe(p),y.onKeyDown.subscribe(h),t.registerPlugin(q),q.onCellRangeSelected.subscribe(u),q.onBeforeCellRangeSelected.subscribe(c),e(window.parent).mouseup(m)}function o(){y.onActiveCellChanged.unsubscribe(p),y.onKeyDown.unsubscribe(h),q.onCellRangeSelected.unsubscribe(u),q.onBeforeCellRangeSelected.unsubscribe(c),y.unregisterPlugin(q),e(window.parent).off("mouseup",m)}function a(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];y.canCellBeSelected(r.fromRow,r.fromCell)&&y.canCellBeSelected(r.toRow,r.toCell)&&t.push(r)}return t}function s(e){(k&&0!==k.length||e&&0!==e.length)&&(k=a(e),E.onSelectedRangesChanged.notify(k))}function l(){return k}function d(e){k=[];for(var t=0;t<e.length;t++)k.push(n.rangeForRow(y,e[t]))}function c(e){if(y.getEditorLock().isActive())return e.stopPropagation(),!1}function u(e,t){s([t.range])}function p(e,t){v.selectActiveCell&&null!=t.row&&null!=t.cell&&s([new S.Range(t.row,t.cell)])}function f(e){return e.which==b||e.which==w||e.which==x||e.which==C}function _(e){return e.shiftKey&&!e.ctrlKey&&!e.altKey&&f(e)}function g(e){return a([e]).length}function h(e){function t(t){return e.which===t}var n,r,i=y.getActiveCell();if(i&&_(e)){n=l(),n.length||n.push(new S.Range(i.row,i.cell)),r=n.pop(),r.contains(i.row,i.cell)||(r=new S.Range(i.row,i.cell));var o=function(e,t){var n={};return n.row=e.fromRow===t.row?e.toRow:e.fromRow,n.cell=e.fromCell===t.cell?e.toCell:e.fromCell,n}(r,i);switch(function(){return e.which}()){case w:o.cell-=1;break;case b:o.cell+=1;break;case x:o.row-=1;break;case C:o.row+=1}var a=function(e,t){var n=e.cell<=t.cell?e.cell:t.cell,r=e.cell<=t.cell?t.cell:e.cell,i=e.row<=t.row?e.row:t.row,o=e.row<=t.row?t.row:e.row;return new S.Range(i,n,o,r)}(i,o);if(g(a)){var d=function(){return i.row===a.fromRow}()?a.toRow:a.fromRow,c=function(){return i.cell===a.fromCell}()?a.toCell:a.fromCell;t(b)||t(w)?y.scrollColumnIntoView(c):(t(x)||t(C))&&y.scrollRowIntoView(d),n.push(a)}else n.push(r);s(n),e.preventDefault(),e.stopPropagation()}}function m(){var e=q.getCurrentRange();t.isUndefined(e)||y.onDragEnd.notify({range:e})}var y,v,b=39,w=37,x=38,C=40,S=window.Slick,k=[],E=this,q=new S.CellRangeSelector({selectionCss:{border:"2px solid black"},offset:{top:0,left:-1,height:2,width:1}}),O={selectActiveCell:!0};e.extend(this,{getSelectedRanges:l,setSelectedRanges:s,setSelectedRows:d,init:i,destroy:o,onSelectedRangesChanged:new S.Event})}}.apply(t,r))&&(e.exports=i)},330:function(e,t,n){"use strict";var r,i;r=[n(0),n(1),n(31)],void 0!==(i=function(e,t,n){function r(t){e(t).prop("disabled",!0)}function i(t){e(t).prop("disabled",!1)}function o(e,n,r,i){return t.reduce(e,function(e,t){var o=r.getItem(t);return a(o,n)?e:(e[o[i]]=s(n,o),e)},{})}function a(e,n){return!!t.isUndefined(e)||!t.isUndefined(t.find(n,function(n){return t.isUndefined(e[n])}))}function s(e,n){var r={};return e&&e.length&&t.each(t.keys(n),function(i){t.contains(e,i)&&(r[i]=n[i])}),r}function l(e,n){var r=e.grid.getData();return o(n,t.keys(e.keys),r,e.client_primary_key)}return function(){function e(e){o.editor.handler.data_store.staged_rows=e}var o=this;if(r("#btn-delete-row"),r("#btn-copy-row"),this.selection.getSelectedRanges().length>0&&i("#btn-copy-row"),function(){return n.areAllRangesCompleteRows(o.grid,o.selection.getSelectedRanges())}()){var a=n.getIndexesOfCompleteRows(this.grid,this.selection.getSelectedRanges()),s=l(o,a);e(s),t.isEmpty(s)&&this.selection.setSelectedRows([]),function(){return o.editor.handler.can_edit}()&&i("#btn-delete-row")}else e({})}}.apply(t,r))&&(e.exports=i)},331:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryCollection=void 0;var r=n(332),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.HistoryCollection=i.default},332:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){r(this,e),this.historyList=t,this.onChange(function(){})}return i(e,[{key:"length",value:function(){return this.historyList.length}},{key:"add",value:function(e){this.historyList.push(e),this.onChangeHandler(this.historyList)}},{key:"reset",value:function(){this.historyList=[],this.onResetHandler(this.historyList)}},{key:"onChange",value:function(e){this.onChangeHandler=e}},{key:"onReset",value:function(e){this.onResetHandler=e}}]),e}();t.default=o},333:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.QueryHistory=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(23),d=r(l),c=n(98),u=r(c),p=n(421),f=r(p),_=n(1),g=r(_),h=n(459),m=r(h),y=n(465),v=r(y),b=n(48),w=r(b),x={overflowY:"auto"},C={display:"flex"},S=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={history:[],selectedEntry:0},n.selectHistoryEntry=n.selectHistoryEntry.bind(n),n}return a(t,e),s(t,[{key:"componentWillMount",value:function(){var e=this;this.setHistory(this.props.historyCollection.historyList),this.selectHistoryEntry(0),this.props.historyCollection.onChange(function(t){e.setHistory(t),e.selectHistoryEntry(0)}),this.props.historyCollection.onReset(function(){e.setState({history:[],currentHistoryDetail:void 0,selectedEntry:0})})}},{key:"componentDidMount",value:function(){this.selectHistoryEntry(0)}},{key:"refocus",value:function(){var e=this;this.state.history.length>0&&setTimeout(function(){return e.retrieveSelectedQuery().parentElement.focus()},0)}},{key:"retrieveSelectedQuery",value:function(){return u.default.findDOMNode(this).getElementsByClassName("selected")[0]}},{key:"setHistory",value:function(e){this.setState({history:this.orderedHistory(e)})}},{key:"selectHistoryEntry",value:function(e){this.setState({currentHistoryDetail:this.state.history[e],selectedEntry:e})}},{key:"orderedHistory",value:function(e){return g.default.chain(e).sortBy(function(e){return e.start_time}).reverse().value()}},{key:"render",value:function(){return d.default.createElement(f.default,{defaultSize:"50%",split:"vertical",pane1Style:x,pane2Style:C},d.default.createElement(v.default,{historyEntries:this.state.history,selectedEntry:this.state.selectedEntry,onSelectEntry:this.selectHistoryEntry}),d.default.createElement(m.default,{historyEntry:this.state.currentHistoryDetail}))}}]),t}(d.default.Component);t.default=S,S.propTypes={historyCollection:w.default.historyCollectionClass.isRequired},t.QueryHistory=S},37:function(e,t,n){"use strict";(function(e){var r,i,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(s){"object"==a(t)&&"object"==a(e)?s(n(13)):(i=[n(13)],r=s,void 0!==(o="function"==typeof r?r.apply(t,i):r)&&(e.exports=o))}(function(e){e.pgadminKeywordRangeFinder=function(t,n,r,i){for(var o,a,s=n.line,l=t.getLine(s),d=l.length;d>0;){var c=l.lastIndexOf(r,d),u=r,p=i;if(c<n.ch){var c=l.lastIndexOf("[",d);if(c<n.ch)break;var u="[",p="]"}if(a=t.getTokenAt(e.Pos(s,c+1)).type,!/^(comment|string)/.test(a)){o=c;break}d=c-1}if(!(null==o||l.lastIndexOf(u)>o)){var f,_,g=1,h=t.lineCount();e:for(var m=s+1;m<h;++m)for(var y=t.getLine(m),v=0;;){var b=y.indexOf(u,v),w=y.indexOf(p,v);if(b<0&&(b=y.length),w<0&&(w=y.length),(v=Math.min(b,w))==y.length)break;if(t.getTokenAt(e.Pos(m,v+1)).type==a)if(v==b)++g;else if(!--g){f=m,_=v;break e}++v}if(null!=f&&f!=s+1)return{from:e.Pos(s,o+r.length),to:e.Pos(f,_)}}},e.pgadminBeginRangeFinder=function(t,n){return e.pgadminKeywordRangeFinder(t,n,"BEGIN","END;")},e.pgadminIfRangeFinder=function(t,n){return e.pgadminKeywordRangeFinder(t,n,"IF","END IF")},e.pgadminLoopRangeFinder=function(t,n){return e.pgadminKeywordRangeFinder(t,n,"LOOP","END LOOP")},e.pgadminCaseRangeFinder=function(t,n){return e.pgadminKeywordRangeFinder(t,n,"CASE","END CASE")}})}).call(t,n(45)(e))},43:function(t,n){t.exports=e},44:function(e,n){e.exports=t},459:function(e,t,n){"use strict";(function(e){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(23),d=r(l),c=n(460),u=r(c),p=n(461),f=r(p),_=n(463),g=r(_),h=n(464),m=r(h),y=n(48),v=r(y),b=function(t){function n(){return i(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return a(n,t),s(n,[{key:"render",value:function(){if(e.isUndefined(this.props.historyEntry))return d.default.createElement("p",null);var t=null;return this.props.historyEntry.status||(t=d.default.createElement("div",{className:"error-message-block"},d.default.createElement(m.default,this.props))),d.default.createElement("div",{id:"query_detail",className:"query-detail"},t,d.default.createElement("div",{className:"metadata-block"},d.default.createElement(u.default,this.props)),d.default.createElement("div",{className:"query-statement-block"},d.default.createElement(f.default,this.props)),d.default.createElement("div",null,d.default.createElement("hr",{className:"block-divider"})),d.default.createElement("div",{className:"message-block"},d.default.createElement(g.default,this.props)))}}]),n}(d.default.Component);t.default=b,b.propTypes={historyEntry:v.default.historyDetail}}).call(t,n(1))},460:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(23),d=r(l),c=n(46),u=r(c),p=n(48),f=r(p),_=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"formatDate",value:function(e){return(0,u.default)(e).format("M-D-YY HH:mm:ss")}},{key:"queryMetaData",value:function(e,t){return d.default.createElement("div",{className:"item"},d.default.createElement("span",{className:"value"},e),d.default.createElement("span",{className:"description"},t))}},{key:"render",value:function(){return d.default.createElement("div",{className:"metadata"},this.queryMetaData(this.formatDate(this.props.historyEntry.start_time),"Date"),this.queryMetaData(this.props.historyEntry.row_affected.toLocaleString(),"Rows Affected"),this.queryMetaData(this.props.historyEntry.total_time,"Duration"))}}]),t}(d.default.Component);t.default=_,_.propTypes={historyEntry:f.default.historyDetail}},461:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(23),d=r(l);n(49);var c=n(462),u=r(c),p=n(48),f=r(p),_=n(159),g=r(_),h=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.copyAllHandler=n.copyAllHandler.bind(n),n.state={isCopied:!1},n.timeout=void 0,n}return a(t,e),s(t,[{key:"copyAllHandler",value:function(){var e=this;g.default.copyTextToClipboard(this.props.historyEntry.query),this.clearPreviousTimeout(),this.setState({isCopied:!0}),this.timeout=setTimeout(function(){e.setState({isCopied:!1})},1500)}},{key:"clearPreviousTimeout",value:function(){void 0!==this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0)}},{key:"copyButtonText",value:function(){return this.state.isCopied?"Copied!":"Copy All"}},{key:"copyButtonClass",value:function(){return this.state.isCopied?"was-copied":"copy-all"}},{key:"render",value:function(){return d.default.createElement("div",{id:"history-detail-query"},d.default.createElement("button",{className:this.copyButtonClass(),onClick:this.copyAllHandler},this.copyButtonText()),d.default.createElement(u.default,{value:this.props.historyEntry.query,options:{mode:"text/x-pgsql",readOnly:!0}}))}}]),t}(d.default.Component);t.default=h,h.propTypes={historyEntry:f.default.historyDetail}},462:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(23),d=r(l),c=n(0),u=r(c),p=n(28),f=r(p),_=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={shouldHydrate:!0},n}return a(t,e),s(t,[{key:"componentDidMount",value:function(){this.editor=(0,f.default)(this.container),this.hydrateInterval=setInterval(this.hydrateWhenBecomesVisible.bind(this),100),this.hydrate(this.props)}},{key:"componentWillUnmount",value:function(){clearInterval(this.hydrateInterval)}},{key:"componentWillReceiveProps",value:function(e){this.hydrate(e)}},{key:"hydrateWhenBecomesVisible",value:function(){var e=(0,u.default)(this.container).is(":visible");e&&this.state.shouldHydrate?(this.hydrate(this.props),this.setState({shouldHydrate:!1})):e||this.setState({shouldHydrate:!0})}},{key:"hydrate",value:function(e){var t=this;Object.keys(e.options||{}).forEach(function(n){return t.editor.setOption(n,e.options[n])}),this.editor.setValue(e.value||""),this.editor.refresh()}},{key:"render",value:function(){var e=this;return d.default.createElement("div",{ref:function(t){return e.container=t}})}}]),t}(d.default.Component);t.default=_},463:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(23),d=r(l),c=n(48),u=r(c),p=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"render",value:function(){return d.default.createElement("div",{className:"message"},d.default.createElement("div",{className:"message-header"},"Messages"),d.default.createElement("div",{className:"content"},d.default.createElement("pre",{className:"content-value"},this.props.historyEntry.message)))}}]),t}(d.default.Component);t.default=p,p.propTypes={historyEntry:u.default.historyDetail}},464:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(23),d=r(l),c=n(48),u=r(c),p=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"parseErrorMessage",value:function(e){return e.match(/ERROR:\s*([^\n\r]*)/i)?e.match(/ERROR:\s*([^\n\r]*)/i)[1]:e}},{key:"render",value:function(){return d.default.createElement("div",{className:"history-error-text"},d.default.createElement("span",null,"Error Message")," ",this.parseErrorMessage(this.props.historyEntry.message))}}]),t}(d.default.Component);t.default=p,p.propTypes={historyEntry:u.default.historyDetail}},465:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(23),d=r(l),c=n(98),u=r(c),p=n(1),f=r(p),_=n(46),g=r(_),h=n(38),m=r(h),y=n(466),v=r(y),b=n(467),w=r(b),x=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.navigateUpAndDown=n.navigateUpAndDown.bind(n),n}return a(t,e),s(t,[{key:"navigateUpAndDown",value:function(e){var t=[38,40],n=e.keyCode||e.which;return!(t.indexOf(n)>-1)||(e.preventDefault(),this.onKeyDownHandler(e),!1)}},{key:"onKeyDownHandler",value:function(e){if(this.isArrowDown(e)){if(!this.isLastEntry()){var t=this.props.selectedEntry+1;this.props.onSelectEntry(t),this.isInvisible(this.getEntryFromList(t))&&this.getEntryFromList(t).scrollIntoView(!1)}}else if(this.isArrowUp(e)&&!this.isFirstEntry()){var n=this.props.selectedEntry-1;this.props.onSelectEntry(n),this.isInvisible(this.getEntryFromList(n))&&this.getEntryFromList(n).scrollIntoView(!0)}}},{key:"retrieveGroups",value:function(){var e=this,t=f.default.groupBy(this.props.historyEntries,function(e){return(0,g.default)(e.start_time).format("YYYY MM DD")}),n=this.sortDesc(t).map(function(n,r){var i=e.retrieveDateGroup(t,n,r),o=(0,g.default)(n,"YYYY MM DD").toDate();return i.unshift(d.default.createElement("li",{key:"group-"+r},d.default.createElement(w.default,{date:o}))),i});return d.default.createElement("ul",null,f.default.flatten(n).map(function(e){return e}))}},{key:"retrieveDateGroup",value:function(e,t,n){var r=this,i=f.default.reduce(f.default.first(this.sortDesc(e),n),function(t,n){return t+e[n].length},0);return e[t].map(function(e,t){return d.default.createElement("li",{key:"group-"+n+"-entry-"+t,className:"list-item",tabIndex:0,onClick:function(){return r.props.onSelectEntry(i+t)},onKeyDown:r.navigateUpAndDown},d.default.createElement(v.default,{historyEntry:e,isSelected:i+t===r.props.selectedEntry}))})}},{key:"sortDesc",value:function(e){return Object.keys(e).sort().reverse()}},{key:"isInvisible",value:function(e){return this.isAbovePaneTop(e)||this.isBelowPaneBottom(e)}},{key:"isArrowUp",value:function(e){return 38===(e.keyCode||e.which)}},{key:"isArrowDown",value:function(e){return 40===(e.keyCode||e.which)}},{key:"isFirstEntry",value:function(){return 0===this.props.selectedEntry}},{key:"isLastEntry",value:function(){return this.props.selectedEntry===this.props.historyEntries.length-1}},{key:"isAbovePaneTop",value:function(e){var t=u.default.findDOMNode(this).parentElement;return e.getBoundingClientRect().top<t.getBoundingClientRect().top}},{key:"isBelowPaneBottom",value:function(e){var t=u.default.findDOMNode(this).parentElement;return e.getBoundingClientRect().bottom>t.getBoundingClientRect().bottom}},{key:"getEntryFromList",value:function(e){return u.default.findDOMNode(this).getElementsByClassName("entry")[e]}},{key:"render",value:function(){return d.default.createElement("div",{id:"query_list",className:"query-history"},this.retrieveGroups())}}]),t}(d.default.Component);t.default=x,x.propTypes={historyEntries:m.default.array.isRequired,selectedEntry:m.default.number.isRequired,onSelectEntry:m.default.func.isRequired}},466:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(23),d=r(l),c=n(48),u=r(c),p=n(46),f=r(p),_=n(38),g=r(_),h=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"formatDate",value:function(e){return(0,f.default)(e).format("HH:mm:ss")}},{key:"renderWithClasses",value:function(e){return d.default.createElement("div",{className:"entry "+e},d.default.createElement("div",{className:"query"},this.props.historyEntry.query),d.default.createElement("div",{className:"other-info"},d.default.createElement("div",{className:"timestamp"},this.formatDate(this.props.historyEntry.start_time))))}},{key:"render",value:function(){return this.hasError()?this.props.isSelected?this.renderWithClasses("error selected"):this.renderWithClasses("error"):this.props.isSelected?this.renderWithClasses("selected"):this.renderWithClasses("")}},{key:"hasError",value:function(){return!this.props.historyEntry.status}}]),t}(d.default.Component);t.default=h,h.propTypes={historyEntry:u.default.historyDetail,isSelected:g.default.bool}},467:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(23),d=r(l),c=n(46),u=r(c),p=n(38),f=r(p),_=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"getDatePrefix",value:function(){var e="";return this.isDaysBefore(0)?e="Today - ":this.isDaysBefore(1)&&(e="Yesterday - "),e}},{key:"getDateFormatted",value:function(e){return e.format(t.formatString)}},{key:"getDateMoment",value:function(){return(0,u.default)(this.props.date)}},{key:"isDaysBefore",value:function(e){return this.getDateFormatted(this.getDateMoment())===this.getDateFormatted((0,u.default)().subtract(e,"days"))}},{key:"render",value:function(){return d.default.createElement("div",{className:"date-label"},this.getDatePrefix(),this.getDateFormatted(this.getDateMoment()))}}]),t}(d.default.Component);t.default=_,_.propTypes={date:f.default.instanceOf(Date).isRequired},_.formatString="MMM DD YYYY"},468:function(e,t,n){"use strict";function r(e,t,n){function r(){n.cancelBubble=!0,n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation()}if(!e.isQueryRunning()){var i=n.which||n.keyCode;i===d?(n.preventDefault(),t.executeQuery(e)):n.shiftKey&&i===c?(r(),t.explainAnalyze(e)):i===c?(r(),t.explain(e)):i===u?(n.preventDefault(),t.download(e)):(this.isMac()&&n.metaKey||!this.isMac()&&n.ctrlKey)&&!n.altKey&&n.shiftKey&&i===f?(r(),t.commentBlockCode(e)):(this.isMac()&&!this.isKeyCtrlAltShift(n)&&n.metaKey||!this.isMac()&&!this.isKeyAltShift(n)&&n.ctrlKey)&&i===f?(r(),t.commentLineCode(e)):(this.isMac()&&!this.isKeyCtrlAltShift(n)&&n.metaKey||!this.isMac()&&!this.isKeyAltShift(n)&&n.ctrlKey)&&i===p&&(r(),t.uncommentLineCode(e))}}function i(){return-1!=window.navigator.platform.search("Mac")}function o(e){return e.ctrlKey||e.altKey}function a(e){return e.altKey||e.shiftKey}function s(e){return e.ctrlKey||e.shiftKey}function l(e){return e.ctrlKey||e.altKey||e.shiftKey}var d=116,c=118,u=119,p=190,f=191;e.exports={processEvent:r,isMac:i,isKeyCtrlAlt:o,isKeyAltShift:a,isKeyCtrlShift:s,isKeyCtrlAltShift:l}},469:function(e,t,n){"use strict";var r=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r),o={_verbose:function(){return(0,i.default)(".explain-verbose").hasClass("visibility-hidden")?"OFF":"ON"},_costsEnabled:function(){return(0,i.default)(".explain-costs").hasClass("visibility-hidden")?"OFF":"ON"},_buffers:function(){return(0,i.default)(".explain-buffers").hasClass("visibility-hidden")?"OFF":"ON"},_timing:function(){return(0,i.default)(".explain-timing").hasClass("visibility-hidden")?"OFF":"ON"},_clearMessageTab:function(){(0,i.default)(".sql-editor-message").html("")},executeQuery:function(e){e.is_query_tool?(this._clearMessageTab(),e.execute()):e.execute_data_query()},explainAnalyze:function(e){var t=this._costsEnabled(),n=this._verbose(),r=this._buffers(),i=this._timing(),o="EXPLAIN (FORMAT JSON, ANALYZE ON, VERBOSE "+n+", COSTS "+t+", BUFFERS "+r+", TIMING "+i+") ";this._clearMessageTab(),e.execute(o)},explain:function(e){var t=this._costsEnabled(),n=this._verbose(),r="EXPLAIN (FORMAT JSON, ANALYZE OFF, VERBOSE "+n+", COSTS "+t+", BUFFERS OFF, TIMING OFF) ";this._clearMessageTab(),e.execute(r)},download:function(e){var t=e.gridView.query_tool_obj.getSelection();if(t||(t=e.gridView.query_tool_obj.getValue()),t){var n="data-"+(new Date).getTime()+".csv";e.is_query_tool||(n=e.table_name+".csv"),e.trigger_csv_download(t,n)}},commentBlockCode:function(e){var t=e.gridView.query_tool_obj;t.getValue()&&t.toggleComment(t.getCursor(!0),t.getCursor(!1))},commentLineCode:function(e){var t=e.gridView.query_tool_obj;t.getValue()&&t.lineComment(t.getCursor(!0),t.getCursor(!1),{lineComment:"--"})},uncommentLineCode:function(e){var t=e.gridView.query_tool_obj;t.getValue()&&t.uncomment(t.getCursor(!0),t.getCursor(!1),{lineComment:"--"})}};e.exports=o},470:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(471),n(472),n(77),n(473),n(474),n(475),n(476),n(477),n(478),n(479),t.default=window.Slick},48:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(38),i=function(e){return e&&e.__esModule?e:{default:e}}(r),o=i.default.shape({query:i.default.string,start_time:i.default.instanceOf(Date),status:i.default.bool,total_time:i.default.string,row_affected:i.default.int,message:i.default.string}),a=i.default.shape({historyList:i.default.array.isRequired,onChange:i.default.func.isRequired});t.default={historyDetail:o,historyCollectionClass:a}},483:function(e,t,n){"use strict";var r,i;r=[n(195),n(31)],void 0!==(i=function(e,t){return function(n,r){var i=n.keyCode,o=n.ctrlKey||n.metaKey,a=this||window;a.slickgrid=r.grid,a.csvOptions,o&&67==i&&e.apply(a),o&&65==i&&t.selectAll(a.slickgrid)}}.apply(t,r))&&(e.exports=i)},5:function(e,t,n){"use strict";var r,i;r=[n(44)],void 0!==(i=function(e){return function(t,n){var r=e[t],i=/([<])([^:^>]*:)?([^>]+)([>])/g,o=r;return r?o=o.replace(i,function(e,t,r,i){return i in n?n[i]:e}):r}}.apply(t,r))&&(e.exports=i)},76:function(e,t){e.exports=n},95:function(e,t){e.exports=r},96:function(e,t,n){"use strict";function r(e,t,n,r,i,a){var s="";return o.default.each(o.default.sortBy(o.default.pick(t,i),function(e){return e.priority}),function(e){s=s+"/"+encodeURI(e._id)}),s=a?s+"/"+a:s+"/",""+e+r+"/"+n+s}var i=n(1),o=function(e){return e&&e.__esModule?e:{default:e}}(i);e.exports={generate_url:r}}},[321]).default});